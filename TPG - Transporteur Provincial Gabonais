Transport Platform for Gabon - "Transporteur Provincial Gabonais" (TPG)
Transporteur Provincial Gabonais (TPG) - Platform Overview
1. What is TPG?
Transporteur Provincial Gabonais (TPG) is a gig economy-style platform that connects individuals with vehicles to merchants and producers across Gabon’s 9 provinces who need goods transported to Libreville. It serves as a logistics extension of Marché Provincial Gabonais (MPG), an e-commerce platform for local producers.

TPG enables:
✔ Efficient transport of goods from rural areas to Libreville
✔ Income opportunities for drivers with available vehicle space
✔ Reliable delivery for MPG sellers
✔ Cost-effective logistics compared to traditional freight services

2. How It Works
Step-by-Step Process
Step    Action  Who’s Involved
1️⃣ MPG sellers list products needing transport to Libreville   MPG Sellers
2️⃣ TPG fetches these listings and displays them to transporters    TPG System
3️⃣ Transporters place bids (price & delivery date) Independent Transporters
4️⃣ Admin or seller selects the best offer  Admin / MPG Seller
5️⃣ Transporter picks up goods and delivers to Libreville   Transporter
6️⃣ Delivery is confirmed, and payment is processed TPG / MPG System
3. Who Uses TPG & Their Roles
Role    Description Permissions
🚚 Transporters  Individuals with vehicles (cars, trucks, motorbikes) who bid on deliveries  - Register & set vehicle details
- Bid on deliveries
- Update delivery status
🛒 MPG Sellers   Local producers listing goods on MPG needing transport  - Request transport via MPG
- Approve/reject transporter bids
👨‍💼 Admin   Manages TPG platform, approves transporters, monitors deliveries    - Approve/reject transporters
- Ban fraudulent users
- Resolve disputes
📦 MPG Buyers (Libreville)   Customers ordering goods via MPG    - Track deliveries (via MPG)
4. Key Features
For Transporters
✔ Browse available shipments – See goods needing transport from any province
✔ Bid competitively – Set your price and proposed delivery date
✔ Manage deliveries – Update pickup & delivery status
✔ Earnings tracking – View completed jobs and payments

For MPG Sellers
✔ Request transport – When listing products on MPG, mark items needing delivery
✔ Compare bids – Choose the best transporter offer
✔ Track shipments – Monitor goods in transit to Libreville

For Admins
✔ Approve transporters – Verify IDs, vehicle documents, and reliability
✔ Monitor deliveries – Ensure timely and secure transport
✔ Ban bad actors – Remove fraudulent transporters

5. How TPG Connects to MPG
Data Flow Between MPG & TPG
MPG lists products needing transport

When sellers create listings, they specify:

Pickup location (province + exact address)

Delivery deadline (when it must reach Libreville)

Weight/dimensions (to match with vehicle capacity)

TPG fetches these listings via API

TPG pulls MPG data using a secure API connection

Displays them on the TPG platform for transporters to bid

Selected bids update MPG’s system

Once a bid is accepted, TPG notifies MPG to update the order status

MPG buyers can then track the shipment

Delivery confirmation syncs back

When the transporter marks delivery as complete, TPG updates MPG

Sample API Integration (MPG → TPG)
php
// TPG fetches products needing transport from MPG
$mpg_api_url = "https://marcheprovincial.ga/api/needs-transport";
$response = file_get_contents($mpg_api_url);
$products = json_decode($response, true);

// Display on TPG platform
foreach ($products as $product) {
    echo "<div class='shipment-card'>";
    echo "<h3>{$product['name']}</h3>";
    echo "<p>From: {$product['province']} to Libreville</p>";
    echo "<p>Deadline: {$product['deadline']}</p>";
    echo "<button>Place Bid</button>";
    echo "</div>";
}
6. Benefits of TPG
For Transporters    For MPG Sellers For Gabon’s Economy
✅ Earn money using spare vehicle capacity   ✅ Affordable, flexible transport    ✅ Reduces logistics costs
✅ Choose jobs that fit their routes ✅ Faster deliveries than traditional freight    ✅ Supports local drivers
✅ Build a reputation with ratings   ✅ Reliable, tracked shipments   ✅ Boosts e-commerce growth
7. Future Improvements
📌 Mobile App – For transporters to bid on the go
📌 Real-Time GPS Tracking – For live shipment monitoring
📌 Automated Bidding – AI suggests competitive prices
📌 Expansion to Other Cities – Beyond Libreville

Conclusion
TPG bridges Gabon’s logistics gap by connecting available vehicles with e-commerce deliveries. By integrating with MPG, it ensures a seamless flow of goods from producers to consumers while empowering independent transporters.


Folder Structure
text

/transporteur-provincial-gabonais
│
├── /admin
│   ├── dashboard.php
│   ├── gestion_transporteurs.php
│   ├── gestion_commandes.php
│   ├── parametres.php
│   ├── rapports.php
│   └── disputes.php
│
├── /transporteur
│   ├── dashboard.php
│   ├── profil.php
│   ├── offres.php
│   ├── commandes.php
│   ├── paiements.php
│   └── reputation.php
│
├── /includes
│   ├── config.php
│   ├── db_connect.php
│   ├── functions.php
│   ├── auth.php
│   ├── mpg_integration.php
│   ├── header.php
│   ├── footer.php
│   ├── notifications.php
│   └── payment.php
│
├── /api
│   ├── v1/
│   │   ├── transporteurs.php
│   │   ├── marchandises.php
│   │   ├── offres.php
│   │   └── auth.php
│
├── /assets
│   ├── /css
│   │   ├── style.css
│   │   └── dashboard.css
│   ├── /js
│   │   ├── main.js
│   │   ├── dashboard.js
│   │   └── map.js
│   ├── /images
│   │   ├── logo.png
│   │   └── vehicles/
│   └── /fonts
│
├── /emails
│   ├── welcome_transporteur.html
│   ├── welcome_client.html
│   ├── bid_accepted.html
│   └── delivery_confirmation.html
│
├── /docs
│   ├── api.md
│   └── setup.md
│
├── index.php
├── inscription.php
├── connexion.php
├── contact.php
├── mentions_legales.php
├── politique_confidentialite.php
└── .htaccess

admin directory:

1. Admin Dashboard (dashboard.php)
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';

// Verify admin access
if (!isAdmin()) {
    header("Location: /connexion.php");
    exit();
}

// Get statistics for dashboard
$stats = [
    'total_transporters' => getTotalTransporters(),
    'pending_transporters' => getPendingTransporters(),
    'active_shipments' => getActiveShipments(),
    'completed_shipments' => getCompletedShipmentsThisMonth(),
    'revenue' => getMonthlyRevenue(),
    'disputes' => getOpenDisputes()
];

// Get recent activities
$activities = getRecentActivities(10);

include '../includes/header.php';
?>

<div class="container-fluid">
    <div class="row">
        <?php include 'admin_sidebar.php'; ?>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Tableau de bord administrateur</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary">Exporter</button>
                    </div>
                    <button type="button" class="btn btn-sm btn-outline-secondary dropdown-toggle">
                        <span data-feather="calendar"></span>
                        Ce mois
                    </button>
                </div>
            </div>

            <!-- Stats Cards -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card text-white bg-primary h-100">
                        <div class="card-body">
                            <h5 class="card-title">Transporteurs</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="mb-0"><?= $stats['total_transporters'] ?></h2>
                                <span class="h4 mb-0">
                                    <span class="badge bg-light text-primary">+<?= $stats['pending_transporters'] ?> en attente</span>
                                </span>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a href="gestion_transporteurs.php" class="text-white">Voir tous <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <div class="card text-white bg-success h-100">
                        <div class="card-body">
                            <h5 class="card-title">Livraisons</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="mb-0"><?= $stats['active_shipments'] ?></h2>
                                <span class="h4 mb-0">
                                    <span class="badge bg-light text-success"><?= $stats['completed_shipments'] ?> ce mois</span>
                                </span>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a href="gestion_commandes.php" class="text-white">Voir toutes <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <div class="card text-white bg-warning h-100">
                        <div class="card-body">
                            <h5 class="card-title">Revenus & Litiges</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="mb-0"><?= formatCurrency($stats['revenue']) ?></h2>
                                <span class="h4 mb-0">
                                    <span class="badge bg-light text-warning"><?= $stats['disputes'] ?> litiges</span>
                                </span>
                            </div>
                        </div>
                        <div class="card-footer bg-transparent border-top-0">
                            <a href="disputes.php" class="text-white">Résoudre <i class="fas fa-arrow-right"></i></a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activities -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Activités récentes</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Utilisateur</th>
                                    <th>Action</th>
                                    <th>Détails</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($activities as $activity): ?>
                                <tr>
                                    <td><?= formatDateTime($activity['created_at']) ?></td>
                                    <td><?= htmlspecialchars($activity['user_name']) ?></td>
                                    <td><?= htmlspecialchars($activity['action']) ?></td>
                                    <td><?= htmlspecialchars($activity['details']) ?></td>
                                </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Shipment Status Chart -->
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Statut des livraisons</h5>
                </div>
                <div class="card-body">
                    <canvas id="shipmentChart" width="100%" height="30"></canvas>
                </div>
            </div>
        </main>
    </div>
</div>

<?php include '../includes/footer.php'; ?>

<script src="../assets/js/chart.min.js"></script>
<script>
// Shipment status chart
const ctx = document.getElementById('shipmentChart').getContext('2d');
const shipmentChart = new Chart(ctx, {
    type: 'doughnut',
    data: {
        labels: ['En attente', 'En préparation', 'En route', 'Livrées', 'Retardées', 'Annulées'],
        datasets: [{
            data: [12, 5, 8, 24, 3, 2],
            backgroundColor: [
                '#6c757d',
                '#17a2b8',
                '#007bff',
                '#28a745',
                '#ffc107',
                '#dc3545'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'right',
            }
        }
    }
});
</script>
2. Transporter Management (gestion_transporteurs.php)
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';

if (!isAdmin()) {
    header("Location: /connexion.php");
    exit();
}

// Handle actions
if (isset($_GET['action'])) {
    $transporterId = intval($_GET['id']);
    
    switch ($_GET['action']) {
        case 'approve':
            updateTransporterStatus($transporterId, 'approuve');
            logActivity("Transporteur #$transporterId approuvé");
            break;
            
        case 'reject':
            updateTransporterStatus($transporterId, 'rejete');
            logActivity("Transporteur #$transporterId rejeté");
            break;
            
        case 'ban':
            updateTransporterStatus($transporterId, 'banni');
            logActivity("Transporteur #$transporterId banni");
            break;
            
        case 'unban':
            updateTransporterStatus($transporterId, 'approuve');
            logActivity("Transporteur #$transporterId réactivé");
            break;
    }
    
    header("Location: gestion_transporteurs.php");
    exit();
}

// Get transporters based on filter
$filter = $_GET['filter'] ?? 'all';
$transporters = getTransporters($filter);

include '../includes/header.php';
?>

<div class="container-fluid">
    <div class="row">
        <?php include 'admin_sidebar.php'; ?>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Gestion des transporteurs</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <a href="?filter=all" class="btn btn-sm <?= $filter === 'all' ? 'btn-primary' : 'btn-outline-secondary' ?>">Tous</a>
                        <a href="?filter=pending" class="btn btn-sm <?= $filter === 'pending' ? 'btn-primary' : 'btn-outline-secondary' ?>">En attente</a>
                        <a href="?filter=approved" class="btn btn-sm <?= $filter === 'approved' ? 'btn-primary' : 'btn-outline-secondary' ?>">Approuvés</a>
                        <a href="?filter=banned" class="btn btn-sm <?= $filter === 'banned' ? 'btn-primary' : 'btn-outline-secondary' ?>">Bannis</a>
                    </div>
                </div>
            </div>

            <!-- Transporters Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nom</th>
                                    <th>Email/Téléphone</th>
                                    <th>Véhicule</th>
                                    <th>Provinces</th>
                                    <th>Statut</th>
                                    <th>Note</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($transporters as $transporter): ?>
                                <tr>
                                    <td><?= $transporter['id'] ?></td>
                                    <td>
                                        <strong><?= htmlspecialchars($transporter['prenom'] . ' ' . $transporter['nom']) ?></strong>
                                        <br>
                                        <small class="text-muted">Inscrit le: <?= formatDate($transporter['created_at']) ?></small>
                                    </td>
                                    <td>
                                        <?= htmlspecialchars($transporter['email']) ?>
                                        <br>
                                        <?= htmlspecialchars($transporter['telephone']) ?>
                                    </td>
                                    <td>
                                        <?= ucfirst($transporter['type_vehicule']) ?>
                                        <br>
                                        <small class="text-muted">Capacité: <?= $transporter['capacite_kg'] ?>kg</small>
                                    </td>
                                    <td>
                                        <?php 
                                        $provinces = explode(',', $transporter['provinces']);
                                        foreach ($provinces as $province) {
                                            echo '<span class="badge bg-secondary me-1">' . $province . '</span>';
                                        }
                                        ?>
                                    </td>
                                    <td>
                                        <?php 
                                        $statusClass = [
                                            'en_attente' => 'warning',
                                            'approuve' => 'success',
                                            'rejete' => 'danger',
                                            'banni' => 'dark'
                                        ];
                                        ?>
                                        <span class="badge bg-<?= $statusClass[$transporter['statut']] ?>">
                                            <?= getTransporterStatusText($transporter['statut']) ?>
                                        </span>
                                    </td>
                                    <td>
                                        <div class="rating">
                                            <?php for ($i = 1; $i <= 5; $i++): ?>
                                                <i class="fas fa-star<?= $i > $transporter['note_moyenne'] ? '-empty' : '' ?>"></i>
                                            <?php endfor; ?>
                                            <small>(<?= $transporter['total_livraisons'] ?>)</small>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                                Actions
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#viewTransporterModal" 
                                                    data-id="<?= $transporter['id'] ?>"
                                                    data-name="<?= htmlspecialchars($transporter['prenom'] . ' ' . htmlspecialchars($transporter['nom']) ?>"
                                                    data-email="<?= htmlspecialchars($transporter['email']) ?>"
                                                    data-phone="<?= htmlspecialchars($transporter['telephone']) ?>"
                                                    data-vehicle="<?= ucfirst($transporter['type_vehicule']) ?>"
                                                    data-capacity="<?= $transporter['capacite_kg'] ?>kg"
                                                    data-plate="<?= htmlspecialchars($transporter['plaque_immatriculation']) ?>"
                                                    data-license="<?= htmlspecialchars($transporter['permis_numero']) ?>"
                                                    data-provinces="<?= htmlspecialchars($transporter['provinces']) ?>"
                                                    data-status="<?= $transporter['statut'] ?>"
                                                    data-rating="<?= $transporter['note_moyenne'] ?>"
                                                    data-deliveries="<?= $transporter['total_livraisons'] ?>">
                                                    <i class="fas fa-eye me-1"></i> Voir détails
                                                </a></li>
                                                
                                                <?php if ($transporter['statut'] === 'en_attente'): ?>
                                                    <li><a class="dropdown-item text-success" href="?action=approve&id=<?= $transporter['id'] ?>">
                                                        <i class="fas fa-check me-1"></i> Approuver
                                                    </a></li>
                                                    <li><a class="dropdown-item text-danger" href="?action=reject&id=<?= $transporter['id'] ?>">
                                                        <i class="fas fa-times me-1"></i> Rejeter
                                                    </a></li>
                                                <?php elseif ($transporter['statut'] === 'approuve'): ?>
                                                    <li><a class="dropdown-item text-dark" href="?action=ban&id=<?= $transporter['id'] ?>">
                                                        <i class="fas fa-ban me-1"></i> Bannir
                                                    </a></li>
                                                <?php elseif ($transporter['statut'] === 'banni'): ?>
                                                    <li><a class="dropdown-item text-success" href="?action=unban&id=<?= $transporter['id'] ?>">
                                                        <i class="fas fa-check-circle me-1"></i> Réactiver
                                                    </a></li>
                                                <?php endif; ?>
                                                
                                                <li><hr class="dropdown-divider"></li>
                                                <li><a class="dropdown-item text-primary" href="../admin/gestion_commandes.php?transporter=<?= $transporter['id'] ?>">
                                                    <i class="fas fa-truck me-1"></i> Voir livraisons
                                                </a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mt-3">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Précédent</a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Suivant</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- View Transporter Modal -->
<div class="modal fade" id="viewTransporterModal" tabindex="-1" aria-labelledby="viewTransporterModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewTransporterModalLabel">Détails du transporteur</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Informations personnelles</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Nom complet:</th>
                                <td id="modal-name"></td>
                            </tr>
                            <tr>
                                <th>Email:</th>
                                <td id="modal-email"></td>
                            </tr>
                            <tr>
                                <th>Téléphone:</th>
                                <td id="modal-phone"></td>
                            </tr>
                            <tr>
                                <th>Statut:</th>
                                <td id="modal-status"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Informations véhicule</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Type:</th>
                                <td id="modal-vehicle"></td>
                            </tr>
                            <tr>
                                <th>Capacité:</th>
                                <td id="modal-capacity"></td>
                            </tr>
                            <tr>
                                <th>Plaque:</th>
                                <td id="modal-plate"></td>
                            </tr>
                            <tr>
                                <th>Permis:</th>
                                <td id="modal-license"></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6>Provinces desservies</h6>
                        <div id="modal-provinces" class="d-flex flex-wrap gap-1"></div>
                    </div>
                    <div class="col-md-6">
                        <h6>Performance</h6>
                        <div class="rating mb-1">
                            <span id="modal-rating-stars"></span>
                            <small id="modal-deliveries"></small>
                        </div>
                        <div class="progress">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 85%" aria-valuenow="85" aria-valuemin="0" aria-valuemax="100">85% livraisons réussies</div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>Documents</h6>
                        <div class="d-flex gap-2">
                            <div class="card document-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-id-card fa-3x mb-2"></i>
                                    <p class="mb-0">Carte d'identité</p>
                                </div>
                            </div>
                            <div class="card document-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-car fa-3x mb-2"></i>
                                    <p class="mb-0">Carte grise</p>
                                </div>
                            </div>
                            <div class="card document-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-id-badge fa-3x mb-2"></i>
                                    <p class="mb-0">Permis de conduire</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-primary">Voir tous les détails</button>
            </div>
        </div>
    </div>
</div>

<?php include '../includes/footer.php'; ?>

<script>
// View transporter modal
document.getElementById('viewTransporterModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    
    // Update modal content
    document.getElementById('viewTransporterModalLabel').textContent = button.getAttribute('data-name');
    document.getElementById('modal-name').textContent = button.getAttribute('data-name');
    document.getElementById('modal-email').textContent = button.getAttribute('data-email');
    document.getElementById('modal-phone').textContent = button.getAttribute('data-phone');
    document.getElementById('modal-vehicle').textContent = button.getAttribute('data-vehicle');
    document.getElementById('modal-capacity').textContent = button.getAttribute('data-capacity');
    document.getElementById('modal-plate').textContent = button.getAttribute('data-plate');
    document.getElementById('modal-license').textContent = button.getAttribute('data-license');
    
    // Status with badge
    const statusText = {
        'en_attente': 'En attente',
        'approuve': 'Approuvé',
        'rejete': 'Rejeté',
        'banni': 'Banni'
    };
    const statusClass = {
        'en_attente': 'warning',
        'approuve': 'success',
        'rejete': 'danger',
        'banni': 'dark'
    };
    const status = button.getAttribute('data-status');
    document.getElementById('modal-status').innerHTML = 
        `<span class="badge bg-${statusClass[status]}">${statusText[status]}</span>`;
    
    // Provinces
    const provincesContainer = document.getElementById('modal-provinces');
    provincesContainer.innerHTML = '';
    button.getAttribute('data-provinces').split(',').forEach(province => {
        const badge = document.createElement('span');
        badge.className = 'badge bg-secondary';
        badge.textContent = province;
        provincesContainer.appendChild(badge);
    });
    
    // Rating
    const rating = parseFloat(button.getAttribute('data-rating'));
    const ratingContainer = document.getElementById('modal-rating-stars');
    ratingContainer.innerHTML = '';
    for (let i = 1; i <= 5; i++) {
        const star = document.createElement('i');
        star.className = i <= rating ? 'fas fa-star' : 'fas fa-star-empty';
        ratingContainer.appendChild(star);
    }
    
    // Deliveries
    document.getElementById('modal-deliveries').textContent = `(${button.getAttribute('data-deliveries')} livraisons)`;
});
</script>
3. Shipment Management (gestion_commandes.php)
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';

if (!isAdmin()) {
    header("Location: /connexion.php");
    exit();
}

// Handle shipment status updates
if (isset($_POST['update_status'])) {
    $shipmentId = intval($_POST['shipment_id']);
    $newStatus = $_POST['new_status'];
    $notes = $_POST['notes'] ?? '';
    
    if (updateShipmentStatus($shipmentId, $newStatus, $notes)) {
        logActivity("Statut de livraison #$shipmentId mis à jour: $newStatus");
        $_SESSION['success_message'] = "Statut de la livraison mis à jour avec succès.";
    } else {
        $_SESSION['error_message'] = "Erreur lors de la mise à jour du statut.";
    }
    
    header("Location: gestion_commandes.php");
    exit();
}

// Get filter parameters
$filter = $_GET['filter'] ?? 'all';
$province = $_GET['province'] ?? 'all';
$transporterId = $_GET['transporter'] ?? null;
$search = $_GET['search'] ?? '';

// Get shipments based on filters
$shipments = getShipments($filter, $province, $transporterId, $search);

include '../includes/header.php';
?>

<div class="container-fluid">
    <div class="row">
        <?php include 'admin_sidebar.php'; ?>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Gestion des livraisons</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <button type="button" class="btn btn-sm btn-outline-secondary me-2" data-bs-toggle="modal" data-bs-target="#filterModal">
                        <i class="fas fa-filter me-1"></i> Filtres
                    </button>
                    <div class="btn-group me-2">
                        <a href="?filter=all" class="btn btn-sm <?= $filter === 'all' ? 'btn-primary' : 'btn-outline-secondary' ?>">Toutes</a>
                        <a href="?filter=active" class="btn btn-sm <?= $filter === 'active' ? 'btn-primary' : 'btn-outline-secondary' ?>">Actives</a>
                        <a href="?filter=completed" class="btn btn-sm <?= $filter === 'completed' ? 'btn-primary' : 'btn-outline-secondary' ?>">Terminées</a>
                    </div>
                </div>
            </div>

            <!-- Display messages -->
            <?php if (isset($_SESSION['success_message'])): ?>
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <?= $_SESSION['success_message'] ?>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <?php unset($_SESSION['success_message']); ?>
            <?php endif; ?>
            
            <?php if (isset($_SESSION['error_message'])): ?>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <?= $_SESSION['error_message'] ?>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <?php unset($_SESSION['error_message']); ?>
            <?php endif; ?>

            <!-- Shipments Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Marchandise</th>
                                    <th>Origine → Destination</th>
                                    <th>Dates</th>
                                    <th>Transporteur</th>
                                    <th>Statut</th>
                                    <th>Prix</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($shipments as $shipment): ?>
                                <tr>
                                    <td><?= $shipment['id'] ?></td>
                                    <td>
                                        <strong><?= htmlspecialchars($shipment['nom_marchandise']) ?></strong>
                                        <br>
                                        <small class="text-muted"><?= $shipment['poids_kg'] ?>kg, <?= $shipment['dimensions'] ?></small>
                                    </td>
                                    <td>
                                        <span class="badge bg-secondary"><?= $shipment['province_depart'] ?></span> 
                                        <i class="fas fa-arrow-right mx-1"></i> 
                                        <span class="badge bg-primary">Libreville</span>
                                        <br>
                                        <small class="text-muted"><?= formatDate($shipment['date_limite']) ?></small>
                                    </td>
                                    <td>
                                        <?php if ($shipment['date_depart']): ?>
                                            Départ: <?= formatDate($shipment['date_depart']) ?>
                                            <br>
                                        <?php endif; ?>
                                        <?php if ($shipment['date_livraison']): ?>
                                            Livraison: <?= formatDate($shipment['date_livraison']) ?>
                                        <?php endif; ?>
                                    </td>
                                    <td>
                                        <?php if ($shipment['transporteur_id']): ?>
                                            <a href="gestion_transporteurs.php?id=<?= $shipment['transporteur_id'] ?>">
                                                <?= htmlspecialchars($shipment['transporteur_nom']) ?>
                                            </a>
                                            <br>
                                            <small class="text-muted"><?= $shipment['type_vehicule'] ?></small>
                                        <?php else: ?>
                                            <span class="text-muted">Non assigné</span>
                                        <?php endif; ?>
                                    </td>
                                    <td>
                                        <?php 
                                        $statusClass = [
                                            'en_attente' => 'secondary',
                                            'en_preparation' => 'info',
                                            'en_route' => 'primary',
                                            'livre' => 'success',
                                            'retarde' => 'warning',
                                            'annule' => 'danger'
                                        ];
                                        ?>
                                        <span class="badge bg-<?= $statusClass[$shipment['statut']] ?>">
                                            <?= getShipmentStatusText($shipment['statut']) ?>
                                        </span>
                                    </td>
                                    <td>
                                        <?= formatCurrency($shipment['prix']) ?>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                                Actions
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#viewShipmentModal" 
                                                    data-id="<?= $shipment['id'] ?>"
                                                    data-name="<?= htmlspecialchars($shipment['nom_marchandise']) ?>"
                                                    data-description="<?= htmlspecialchars($shipment['description']) ?>"
                                                    data-weight="<?= $shipment['poids_kg'] ?>"
                                                    data-dimensions="<?= htmlspecialchars($shipment['dimensions']) ?>"
                                                    data-origin="<?= $shipment['province_depart'] ?>"
                                                    data-pickup="<?= htmlspecialchars($shipment['adresse_ramassage']) ?>"
                                                    data-delivery="<?= htmlspecialchars($shipment['adresse_livraison']) ?>"
                                                    data-deadline="<?= formatDate($shipment['date_limite']) ?>"
                                                    data-transporter="<?= htmlspecialchars($shipment['transporteur_nom']) ?>"
                                                    data-price="<?= formatCurrency($shipment['prix']) ?>"
                                                    data-status="<?= $shipment['statut'] ?>"
                                                    data-departure="<?= $shipment['date_depart'] ? formatDate($shipment['date_depart']) : 'N/A' ?>"
                                                    data-delivery-date="<?= $shipment['date_livraison'] ? formatDate($shipment['date_livraison']) : 'N/A' ?>">
                                                    <i class="fas fa-eye me-1"></i> Voir détails
                                                </a></li>
                                                
                                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#updateStatusModal" 
                                                    data-id="<?= $shipment['id'] ?>"
                                                    data-current-status="<?= $shipment['statut'] ?>">
                                                    <i class="fas fa-sync-alt me-1"></i> Modifier statut
                                                </a></li>
                                                
                                                <li><hr class="dropdown-divider"></li>
                                                
                                                <li><a class="dropdown-item text-danger" href="#" data-bs-toggle="modal" data-bs-target="#cancelShipmentModal" 
                                                    data-id="<?= $shipment['id'] ?>">
                                                    <i class="fas fa-times-circle me-1"></i> Annuler
                                                </a></li>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mt-3">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Précédent</a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Suivant</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="get" action="gestion_commandes.php">
                <div class="modal-header">
                    <h5 class="modal-title" id="filterModalLabel">Filtrer les livraisons</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="filter" class="form-label">Statut</label>
                        <select class="form-select" id="filter" name="filter">
                            <option value="all" <?= $filter === 'all' ? 'selected' : '' ?>>Toutes les livraisons</option>
                            <option value="active" <?= $filter === 'active' ? 'selected' : '' ?>>Livraisons actives</option>
                            <option value="completed" <?= $filter === 'completed' ? 'selected' : '' ?>>Livraisons terminées</option>
                            <option value="pending" <?= $filter === 'pending' ? 'selected' : '' ?>>En attente</option>
                            <option value="preparation" <?= $filter === 'preparation' ? 'selected' : '' ?>>En préparation</option>
                            <option value="transit" <?= $filter === 'transit' ? 'selected' : '' ?>>En transit</option>
                            <option value="delivered" <?= $filter === 'delivered' ? 'selected' : '' ?>>Livrées</option>
                            <option value="delayed" <?= $filter === 'delayed' ? 'selected' : '' ?>>Retardées</option>
                            <option value="canceled" <?= $filter === 'canceled' ? 'selected' : '' ?>>Annulées</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="province" class="form-label">Province d'origine</label>
                        <select class="form-select" id="province" name="province">
                            <option value="all">Toutes les provinces</option>
                            <?php foreach (getProvinces() as $id => $name): ?>
                                <option value="<?= $id ?>" <?= $province == $id ? 'selected' : '' ?>><?= $name ?></option>
                            <?php endforeach; ?>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="search" class="form-label">Recherche</label>
                        <input type="text" class="form-control" id="search" name="search" placeholder="Nom marchandise, transporteur..." value="<?= htmlspecialchars($search) ?>">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Appliquer les filtres</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- View Shipment Modal -->
<div class="modal fade" id="viewShipmentModal" tabindex="-1" aria-labelledby="viewShipmentModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewShipmentModalLabel">Détails de la livraison</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Informations marchandise</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Nom:</th>
                                <td id="modal-shipment-name"></td>
                            </tr>
                            <tr>
                                <th>Description:</th>
                                <td id="modal-shipment-description"></td>
                            </tr>
                            <tr>
                                <th>Poids:</th>
                                <td id="modal-shipment-weight"></td>
                            </tr>
                            <tr>
                                <th>Dimensions:</th>
                                <td id="modal-shipment-dimensions"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Informations livraison</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Origine:</th>
                                <td id="modal-shipment-origin"></td>
                            </tr>
                            <tr>
                                <th>Adresse ramassage:</th>
                                <td id="modal-shipment-pickup"></td>
                            </tr>
                            <tr>
                                <th>Adresse livraison:</th>
                                <td id="modal-shipment-delivery"></td>
                            </tr>
                            <tr>
                                <th>Date limite:</th>
                                <td id="modal-shipment-deadline"></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h6>Transporteur</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Nom:</th>
                                <td id="modal-shipment-transporter"></td>
                            </tr>
                            <tr>
                                <th>Prix:</th>
                                <td id="modal-shipment-price"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Statut</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Statut actuel:</th>
                                <td id="modal-shipment-status"></td>
                            </tr>
                            <tr>
                                <th>Date départ:</th>
                                <td id="modal-shipment-departure"></td>
                            </tr>
                            <tr>
                                <th>Date livraison:</th>
                                <td id="modal-shipment-delivery-date"></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>Historique des statuts</h6>
                        <div class="timeline">
                            <div class="timeline-item">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <small class="text-muted">Aujourd'hui, 14:32</small>
                                    <p class="mb-1">Livraison confirmée par le client</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <small class="text-muted">Aujourd'hui, 13:45</small>
                                    <p class="mb-1">Livraison effectuée</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <small class="text-muted">Aujourd'hui, 10:15</small>
                                    <p class="mb-1">En route vers Libreville</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <small class="text-muted">Hier, 08:30</small>
                                    <p class="mb-1">Marchandise récupérée</p>
                                </div>
                            </div>
                            <div class="timeline-item">
                                <div class="timeline-point"></div>
                                <div class="timeline-content">
                                    <small class="text-muted">20/05/2023</small>
                                    <p class="mb-1">Transporteur assigné</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-primary">Voir tous les détails</button>
            </div>
        </div>
    </div>
</div>

<!-- Update Status Modal -->
<div class="modal fade" id="updateStatusModal" tabindex="-1" aria-labelledby="updateStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="gestion_commandes.php">
                <input type="hidden" name="shipment_id" id="update-shipment-id">
                <div class="modal-header">
                    <h5 class="modal-title" id="updateStatusModalLabel">Modifier le statut</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="new_status" class="form-label">Nouveau statut</label>
                        <select class="form-select" id="new_status" name="new_status" required>
                            <option value="en_preparation">En préparation</option>
                            <option value="en_route">En route</option>
                            <option value="livre">Livré</option>
                            <option value="retarde">Retardé</option>
                            <option value="annule">Annulé</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes (optionnel)</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" name="update_status" class="btn btn-primary">Mettre à jour</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Cancel Shipment Modal -->
<div class="modal fade" id="cancelShipmentModal" tabindex="-1" aria-labelledby="cancelShipmentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="gestion_commandes.php">
                <input type="hidden" name="shipment_id" id="cancel-shipment-id">
                <input type="hidden" name="new_status" value="annule">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title" id="cancelShipmentModalLabel">Annuler la livraison</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Êtes-vous sûr de vouloir annuler cette livraison? Cette action ne peut pas être annulée.</p>
                    
                    <div class="mb-3">
                        <label for="cancel_reason" class="form-label">Raison de l'annulation (requis)</label>
                        <textarea class="form-control" id="cancel_reason" name="notes" rows="3" required></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Ne pas annuler</button>
                    <button type="submit" name="update_status" class="btn btn-danger">Confirmer l'annulation</button>
                </div>
            </form>
        </div>
    </div>
</div>

<?php include '../includes/footer.php'; ?>

<script>
// View shipment modal
document.getElementById('viewShipmentModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    
    // Update modal content
    document.getElementById('viewShipmentModalLabel').textContent = button.getAttribute('data-name');
    document.getElementById('modal-shipment-name').textContent = button.getAttribute('data-name');
    document.getElementById('modal-shipment-description').textContent = button.getAttribute('data-description');
    document.getElementById('modal-shipment-weight').textContent = button.getAttribute('data-weight') + ' kg';
    document.getElementById('modal-shipment-dimensions').textContent = button.getAttribute('data-dimensions');
    document.getElementById('modal-shipment-origin').textContent = button.getAttribute('data-origin');
    document.getElementById('modal-shipment-pickup').textContent = button.getAttribute('data-pickup');
    document.getElementById('modal-shipment-delivery').textContent = button.getAttribute('data-delivery');
    document.getElementById('modal-shipment-deadline').textContent = button.getAttribute('data-deadline');
    document.getElementById('modal-shipment-transporter').textContent = button.getAttribute('data-transporter') || 'Non assigné';
    document.getElementById('modal-shipment-price').textContent = button.getAttribute('data-price');
    document.getElementById('modal-shipment-departure').textContent = button.getAttribute('data-departure');
    document.getElementById('modal-shipment-delivery-date').textContent = button.getAttribute('data-delivery-date');
    
    // Status with badge
    const statusText = {
        'en_attente': 'En attente',
        'en_preparation': 'En préparation',
        'en_route': 'En route',
        'livre': 'Livré',
        'retarde': 'Retardé',
        'annule': 'Annulé'
    };
    const statusClass = {
        'en_attente': 'secondary',
        'en_preparation': 'info',
        'en_route': 'primary',
        'livre': 'success',
        'retarde': 'warning',
        'annule': 'danger'
    };
    const status = button.getAttribute('data-status');
    document.getElementById('modal-shipment-status').innerHTML = 
        `<span class="badge bg-${statusClass[status]}">${statusText[status]}</span>`;
});

// Update status modal
document.getElementById('updateStatusModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    document.getElementById('update-shipment-id').value = button.getAttribute('data-id');
    
    // Set current status as selected
    const currentStatus = button.getAttribute('data-current-status');
    const statusSelect = document.getElementById('new_status');
    
    for (let i = 0; i < statusSelect.options.length; i++) {
        if (statusSelect.options[i].value === currentStatus) {
            statusSelect.options[i].selected = true;
            break;
        }
    }
});

// Cancel shipment modal
document.getElementById('cancelShipmentModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    document.getElementById('cancel-shipment-id').value = button.getAttribute('data-id');
});
</script>
4. Dispute Resolution (disputes.php)
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';

if (!isAdmin()) {
    header("Location: /connexion.php");
    exit();
}

// Handle dispute resolution
if (isset($_POST['resolve_dispute'])) {
    $disputeId = intval($_POST['dispute_id']);
    $resolution = $_POST['resolution'];
    $notes = $_POST['notes'] ?? '';
    
    if (resolveDispute($disputeId, $resolution, $notes)) {
        logActivity("Litige #$disputeId résolu: $resolution");
        $_SESSION['success_message'] = "Litige résolu avec succès.";
    } else {
        $_SESSION['error_message'] = "Erreur lors de la résolution du litige.";
    }
    
    header("Location: disputes.php");
    exit();
}

// Get disputes
$disputes = getDisputes();

include '../includes/header.php';
?>

<div class="container-fluid">
    <div class="row">
        <?php include 'admin_sidebar.php'; ?>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Gestion des litiges</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <a href="?filter=all" class="btn btn-sm btn-outline-secondary">Tous</a>
                        <a href="?filter=open" class="btn btn-sm btn-primary">Non résolus</a>
                        <a href="?filter=resolved" class="btn btn-sm btn-outline-secondary">Résolus</a>
                    </div>
                </div>
            </div>

            <!-- Display messages -->
            <?php if (isset($_SESSION['success_message'])): ?>
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <?= $_SESSION['success_message'] ?>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <?php unset($_SESSION['success_message']); ?>
            <?php endif; ?>
            
            <?php if (isset($_SESSION['error_message'])): ?>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <?= $_SESSION['error_message'] ?>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <?php unset($_SESSION['error_message']); ?>
            <?php endif; ?>

            <!-- Disputes Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Livraison</th>
                                    <th>Créé par</th>
                                    <th>Raison</th>
                                    <th>Date</th>
                                    <th>Statut</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($disputes as $dispute): ?>
                                <tr>
                                    <td><?= $dispute['id'] ?></td>
                                    <td>
                                        <a href="gestion_commandes.php?id=<?= $dispute['shipment_id'] ?>">
                                            Livraison #<?= $dispute['shipment_id'] ?>
                                        </a>
                                        <br>
                                        <small class="text-muted"><?= htmlspecialchars($dispute['product_name']) ?></small>
                                    </td>
                                    <td>
                                        <?= htmlspecialchars($dispute['user_name']) ?>
                                        <br>
                                        <small class="text-muted"><?= $dispute['user_role'] === 'seller' ? 'Vendeur' : 'Transporteur' ?></small>
                                    </td>
                                    <td>
                                        <?= htmlspecialchars($dispute['reason']) ?>
                                    </td>
                                    <td>
                                        <?= formatDate($dispute['created_at']) ?>
                                    </td>
                                    <td>
                                        <?php if ($dispute['status'] === 'open'): ?>
                                            <span class="badge bg-danger">Non résolu</span>
                                        <?php else: ?>
                                            <span class="badge bg-success">Résolu</span>
                                        <?php endif; ?>
                                    </td>
                                    <td>
                                        <div class="dropdown">
                                            <button class="btn btn-sm btn-outline-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                                Actions
                                            </button>
                                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                                                <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#viewDisputeModal" 
                                                    data-id="<?= $dispute['id'] ?>"
                                                    data-shipment="<?= $dispute['shipment_id'] ?>"
                                                    data-user="<?= htmlspecialchars($dispute['user_name']) ?>"
                                                    data-role="<?= $dispute['user_role'] === 'seller' ? 'Vendeur' : 'Transporteur' ?>"
                                                    data-reason="<?= htmlspecialchars($dispute['reason']) ?>"
                                                    data-details="<?= htmlspecialchars($dispute['details']) ?>"
                                                    data-status="<?= $dispute['status'] ?>"
                                                    data-created="<?= formatDateTime($dispute['created_at']) ?>"
                                                    data-resolved="<?= $dispute['resolved_at'] ? formatDateTime($dispute['resolved_at']) : 'Non résolu' ?>"
                                                    data-resolution="<?= htmlspecialchars($dispute['resolution']) ?>"
                                                    data-resolution-notes="<?= htmlspecialchars($dispute['resolution_notes']) ?>">
                                                    <i class="fas fa-eye me-1"></i> Voir détails
                                                </a></li>
                                                
                                                <?php if ($dispute['status'] === 'open'): ?>
                                                    <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#resolveDisputeModal" 
                                                        data-id="<?= $dispute['id'] ?>">
                                                        <i class="fas fa-gavel me-1"></i> Résoudre
                                                    </a></li>
                                                <?php endif; ?>
                                            </ul>
                                        </div>
                                    </td>
                                </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mt-3">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Précédent</a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Suivant</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- View Dispute Modal -->
<div class="modal fade" id="viewDisputeModal" tabindex="-1" aria-labelledby="viewDisputeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="viewDisputeModalLabel">Détails du litige</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6>Informations de base</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Livraison:</th>
                                <td id="modal-dispute-shipment"></td>
                            </tr>
                            <tr>
                                <th>Créé par:</th>
                                <td id="modal-dispute-user"></td>
                            </tr>
                            <tr>
                                <th>Rôle:</th>
                                <td id="modal-dispute-role"></td>
                            </tr>
                            <tr>
                                <th>Date création:</th>
                                <td id="modal-dispute-created"></td>
                            </tr>
                            <tr>
                                <th>Statut:</th>
                                <td id="modal-dispute-status"></td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <h6>Résolution</h6>
                        <table class="table table-sm">
                            <tr>
                                <th>Résolution:</th>
                                <td id="modal-dispute-resolution"></td>
                            </tr>
                            <tr>
                                <th>Date résolution:</th>
                                <td id="modal-dispute-resolved"></td>
                            </tr>
                            <tr>
                                <th>Notes:</th>
                                <td id="modal-dispute-resolution-notes"></td>
                            </tr>
                        </table>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>Détails du litige</h6>
                        <div class="card">
                            <div class="card-header">
                                <strong>Raison:</strong> <span id="modal-dispute-reason"></span>
                            </div>
                            <div class="card-body">
                                <p id="modal-dispute-details"></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="row mt-3">
                    <div class="col-12">
                        <h6>Preuves</h6>
                        <div class="d-flex gap-2">
                            <div class="card document-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-image fa-3x mb-2"></i>
                                    <p class="mb-0">Image 1</p>
                                </div>
                            </div>
                            <div class="card document-card">
                                <div class="card-body text-center">
                                    <i class="fas fa-file-pdf fa-3x mb-2"></i>
                                    <p class="mb-0">Document</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
                <button type="button" class="btn btn-primary">Voir tous les détails</button>
            </div>
        </div>
    </div>
</div>

<!-- Resolve Dispute Modal -->
<div class="modal fade" id="resolveDisputeModal" tabindex="-1" aria-labelledby="resolveDisputeModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="disputes.php">
                <input type="hidden" name="dispute_id" id="resolve-dispute-id">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title" id="resolveDisputeModalLabel">Résoudre le litige</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="resolution" class="form-label">Décision</label>
                        <select class="form-select" id="resolution" name="resolution" required>
                            <option value="">Sélectionner une décision</option>
                            <option value="seller_fault">Faute du vendeur</option>
                            <option value="transporter_fault">Faute du transporteur</option>
                            <option value="shared_responsibility">Responsabilité partagée</option>
                            <option value="no_fault">Aucune faute</option>
                            <option value="partial_refund">Remboursement partiel</option>
                            <option value="full_refund">Remboursement complet</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes (optionnel)</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Actions à prendre</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notify_parties" name="notify_parties" checked>
                            <label class="form-check-label" for="notify_parties">
                                Notifier les parties concernées
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="adjust_rating" name="adjust_rating" checked>
                            <label class="form-check-label" for="adjust_rating">
                                Ajuster la note du transporteur si applicable
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="process_refund" name="process_refund">
                            <label class="form-check-label" for="process_refund">
                                Traiter le remboursement si applicable
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" name="resolve_dispute" class="btn btn-primary">Confirmer la résolution</button>
                </div>
            </form>
        </div>
    </div>
</div>

<?php include '../includes/footer.php'; ?>

<script>
// View dispute modal
document.getElementById('viewDisputeModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    
    // Update modal content
    document.getElementById('viewDisputeModalLabel').textContent = `Litige #${button.getAttribute('data-id')}`;
    document.getElementById('modal-dispute-shipment').textContent = `Livraison #${button.getAttribute('data-shipment')}`;
    document.getElementById('modal-dispute-user').textContent = button.getAttribute('data-user');
    document.getElementById('modal-dispute-role').textContent = button.getAttribute('data-role');
    document.getElementById('modal-dispute-reason').textContent = button.getAttribute('data-reason');
    document.getElementById('modal-dispute-details').textContent = button.getAttribute('data-details');
    document.getElementById('modal-dispute-created').textContent = button.getAttribute('data-created');
    document.getElementById('modal-dispute-resolved').textContent = button.getAttribute('data-resolved');
    document.getElementById('modal-dispute-resolution').textContent = button.getAttribute('data-resolution') || 'Non résolu';
    document.getElementById('modal-dispute-resolution-notes').textContent = button.getAttribute('data-resolution-notes') || 'Aucune note';
    
    // Status
    if (button.getAttribute('data-status') === 'open') {
        document.getElementById('modal-dispute-status').innerHTML = '<span class="badge bg-danger">Non résolu</span>';
    } else {
        document.getElementById('modal-dispute-status').innerHTML = '<span class="badge bg-success">Résolu</span>';
    }
});

// Resolve dispute modal
document.getElementById('resolveDisputeModal').addEventListener('show.bs.modal', function (event) {
    const button = event.relatedTarget;
    document.getElementById('resolve-dispute-id').value = button.getAttribute('data-id');
});
</script>
5. Reports (rapports.php)
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';

if (!isAdmin()) {
    header("Location: /connexion.php");
    exit();
}

// Get report parameters
$reportType = $_GET['report'] ?? 'monthly';
$startDate = $_GET['start_date'] ?? date('Y-m-01');
$endDate = $_GET['end_date'] ?? date('Y-m-t');
$province = $_GET['province'] ?? 'all';

// Get report data
$reportData = getReportData($reportType, $startDate, $endDate, $province);

include '../includes/header.php';
?>

<div class="container-fluid">
    <div class="row">
        <?php include 'admin_sidebar.php'; ?>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Rapports et statistiques</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#exportModal">
                            <i class="fas fa-file-export me-1"></i> Exporter
                        </button>
                    </div>
                </div>
            </div>

            <!-- Report Filters -->
            <div class="card mb-4">
                <div class="card-body">
                    <form method="get" action="rapports.php">
                        <div class="row">
                            <div class="col-md-3 mb-3">
                                <label for="report" class="form-label">Type de rapport</label>
                                <select class="form-select" id="report" name="report">
                                    <option value="monthly" <?= $reportType === 'monthly' ? 'selected' : '' ?>>Mensuel</option>
                                    <option value="weekly" <?= $reportType === 'weekly' ? 'selected' : '' ?>>Hebdomadaire</option>
                                    <option value="daily" <?= $reportType === 'daily' ? 'selected' : '' ?>>Quotidien</option>
                                    <option value="transporters" <?= $reportType === 'transporters' ? 'selected' : '' ?>>Transporteurs</option>
                                    <option value="provinces" <?= $reportType === 'provinces' ? 'selected' : '' ?>>Par province</option>
                                </select>
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="start_date" class="form-label">Date de début</label>
                                <input type="date" class="form-control" id="start_date" name="start_date" value="<?= $startDate ?>">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="end_date" class="form-label">Date de fin</label>
                                <input type="date" class="form-control" id="end_date" name="end_date" value="<?= $endDate ?>">
                            </div>
                            
                            <div class="col-md-3 mb-3">
                                <label for="province" class="form-label">Province</label>
                                <select class="form-select" id="province" name="province">
                                    <option value="all">Toutes les provinces</option>
                                    <?php foreach (getProvinces() as $id => $name): ?>
                                        <option value="<?= $id ?>" <?= $province == $id ? 'selected' : '' ?>><?= $name ?></option>
                                    <?php endforeach; ?>
                                </select>
                            </div>
                        </div>
                        
                        <div class="text-end">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-filter me-1"></i> Appliquer les filtres
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Report Summary -->
            <div class="row mb-4">
                <div class="col-md-4 mb-3">
                    <div class="card text-white bg-primary h-100">
                        <div class="card-body">
                            <h5 class="card-title">Livraisons</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="mb-0"><?= $reportData['total_shipments'] ?></h2>
                                <span class="h4 mb-0">
                                    <span class="badge bg-light text-primary"><?= $reportData['completed_shipments'] ?> terminées</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <div class="card text-white bg-success h-100">
                        <div class="card-body">
                            <h5 class="card-title">Revenus</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="mb-0"><?= formatCurrency($reportData['total_revenue']) ?></h2>
                                <span class="h4 mb-0">
                                    <span class="badge bg-light text-success"><?= formatCurrency($reportData['platform_earnings']) ?> plateforme</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-4 mb-3">
                    <div class="card text-white bg-info h-100">
                        <div class="card-body">
                            <h5 class="card-title">Transporteurs</h5>
                            <div class="d-flex justify-content-between align-items-center">
                                <h2 class="mb-0"><?= $reportData['active_transporters'] ?></h2>
                                <span class="h4 mb-0">
                                    <span class="badge bg-light text-info"><?= $reportData['new_transporters'] ?> nouveaux</span>
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Report Content -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="mb-0">Statistiques des livraisons</h5>
                </div>
                <div class="card-body">
                    <canvas id="shipmentsChart" width="100%" height="40"></canvas>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Répartition par province</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="provincesChart" width="100%" height="300"></canvas>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="mb-0">Top transporteurs</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Transporteur</th>
                                            <th>Livraisons</th>
                                            <th>Revenu</th>
                                            <th>Note</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php foreach ($reportData['top_transporters'] as $transporter): ?>
                                        <tr>
                                            <td><?= htmlspecialchars($transporter['name']) ?></td>
                                            <td><?= $transporter['shipments'] ?></td>
                                            <td><?= formatCurrency($transporter['earnings']) ?></td>
                                            <td>
                                                <div class="rating">
                                                    <?php for ($i = 1; $i <= 5; $i++): ?>
                                                        <i class="fas fa-star<?= $i > $transporter['rating'] ? '-empty' : '' ?>"></i>
                                                    <?php endfor; ?>
                                                </div>
                                            </td>
                                        </tr>
                                        <?php endforeach; ?>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Détails des livraisons</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Livraison</th>
                                    <th>Province</th>
                                    <th>Transporteur</th>
                                    <th>Statut</th>
                                    <th>Prix</th>
                                </tr>
                            </thead>
                            <tbody>
                                <?php foreach ($reportData['shipment_details'] as $shipment): ?>
                                <tr>
                                    <td><?= formatDate($shipment['date']) ?></td>
                                    <td>
                                        <a href="gestion_commandes.php?id=<?= $shipment['id'] ?>">
                                            #<?= $shipment['id'] ?>
                                        </a>
                                        <br>
                                        <small><?= htmlspecialchars($shipment['product_name']) ?></small>
                                    </td>
                                    <td><?= $shipment['province'] ?></td>
                                    <td><?= htmlspecialchars($shipment['transporter_name']) ?></td>
                                    <td>
                                        <?php 
                                        $statusClass = [
                                            'livre' => 'success',
                                            'en_route' => 'primary',
                                            'retarde' => 'warning',
                                            'annule' => 'danger'
                                        ];
                                        ?>
                                        <span class="badge bg-<?= $statusClass[$shipment['status']] ?>">
                                            <?= getShipmentStatusText($shipment['status']) ?>
                                        </span>
                                    </td>
                                    <td><?= formatCurrency($shipment['price']) ?></td>
                                </tr>
                                <?php endforeach; ?>
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center mt-3">
                            <li class="page-item disabled">
                                <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Précédent</a>
                            </li>
                            <li class="page-item active"><a class="page-link" href="#">1</a></li>
                            <li class="page-item"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#">Suivant</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Export Modal -->
<div class="modal fade" id="exportModal" tabindex="-1" aria-labelledby="exportModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" action="export_report.php">
                <input type="hidden" name="report_type" value="<?= $reportType ?>">
                <input type="hidden" name="start_date" value="<?= $startDate ?>">
                <input type="hidden" name="end_date" value="<?= $endDate ?>">
                <input type="hidden" name="province" value="<?= $province ?>">
                
                <div class="modal-header">
                    <h5 class="modal-title" id="exportModalLabel">Exporter le rapport</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="export_format" class="form-label">Format</label>
                        <select class="form-select" id="export_format" name="format" required>
                            <option value="csv">CSV (Excel)</option>
                            <option value="pdf">PDF</option>
                            <option value="json">JSON</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="export_scope" class="form-label">Portée</label>
                        <select class="form-select" id="export_scope" name="scope" required>
                            <option value="summary">Résumé seulement</option>
                            <option value="detailed" selected>Détails des livraisons</option>
                            <option value="all">Toutes les données</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="export_email" class="form-label">Envoyer à (optionnel)</label>
                        <input type="email" class="form-control" id="export_email" name="email" placeholder="email@example.com">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                    <button type="submit" class="btn btn-primary">Exporter</button>
                </div>
            </form>
        </div>
    </div>
</div>

<?php include '../includes/footer.php'; ?>

<script src="../assets/js/chart.min.js"></script>
<script>
// Shipments chart
const shipmentsCtx = document.getElementById('shipmentsChart').getContext('2d');
const shipmentsChart = new Chart(shipmentsCtx, {
    type: 'line',
    data: {
        labels: <?= json_encode($reportData['chart_labels']) ?>,
        datasets: [
            {
                label: 'Livraisons complétées',
                data: <?= json_encode($reportData['completed_data']) ?>,
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                tension: 0.1,
                fill: true
            },
            {
                label: 'Livraisons totales',
                data: <?= json_encode($reportData['total_data']) ?>,
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                tension: 0.1,
                fill: true
            }
        ]
    },
    options: {
        responsive: true,
        plugins: {
            title: {
                display: true,
                text: 'Livraisons par période'
            },
            tooltip: {
                mode: 'index',
                intersect: false
            }
        },
        scales: {
            y: {
                beginAtZero: true,
                ticks: {
                    stepSize: 1
                }
            }
        }
    }
});

// Provinces chart
const provincesCtx = document.getElementById('provincesChart').getContext('2d');
const provincesChart = new Chart(provincesCtx, {
    type: 'doughnut',
    data: {
        labels: <?= json_encode($reportData['province_labels']) ?>,
        datasets: [{
            data: <?= json_encode($reportData['province_data']) ?>,
            backgroundColor: [
                '#007bff',
                '#28a745',
                '#ffc107',
                '#dc3545',
                '#6c757d',
                '#17a2b8',
                '#6610f2',
                '#fd7e14',
                '#20c997'
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: 'right',
            },
            title: {
                display: true,
                text: 'Livraisons par province'
            }
        }
    }
});
</script>
6. Settings (parametres.php)
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';

if (!isAdmin()) {
    header("Location: /connexion.php");
    exit();
}

// Handle settings update
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    $settings = [
        'platform_fee' => floatval($_POST['platform_fee']),
        'min_transporter_fee' => floatval($_POST['min_transporter_fee']),
        'max_shipment_weight' => floatval($_POST['max_shipment_weight']),
        'default_deadline_days' => intval($_POST['default_deadline_days']),
        'notify_new_shipments' => isset($_POST['notify_new_shipments']) ? 1 : 0,
        'notify_disputes' => isset($_POST['notify_disputes']) ? 1 : 0,
        'admin_email' => $_POST['admin_email'],
        'support_phone' => $_POST['support_phone']
    ];
    
    if (updateSettings($settings)) {
        $_SESSION['success_message'] = "Paramètres mis à jour avec succès.";
    } else {
        $_SESSION['error_message'] = "Erreur lors de la mise à jour des paramètres.";
    }
    
    header("Location: parametres.php");
    exit();
}

// Get current settings
$settings = getSettings();

include '../includes/header.php';
?>

<div class="container-fluid">
    <div class="row">
        <?php include 'admin_sidebar.php'; ?>
        
        <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2">Paramètres de la plateforme</h1>
            </div>

            <!-- Display messages -->
            <?php if (isset($_SESSION['success_message'])): ?>
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <?= $_SESSION['success_message'] ?>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <?php unset($_SESSION['success_message']); ?>
            <?php endif; ?>
            
            <?php if (isset($_SESSION['error_message'])): ?>
                <div class="alert alert-danger alert-dismissible fade show" role="alert">
                    <?= $_SESSION['error_message'] ?>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <?php unset($_SESSION['error_message']); ?>
            <?php endif; ?>

            <form method="post" action="parametres.php">
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Paramètres financiers</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="platform_fee" class="form-label">Frais de plateforme (%)</label>
                                <div class="input-group">
                                    <input type="number" step="0.1" min="0" max="50" class="form-control" id="platform_fee" 
                                        name="platform_fee" value="<?= $settings['platform_fee'] ?>" required>
                                    <span class="input-group-text">%</span>
                                </div>
                                <small class="text-muted">Pourcentage retenu par la plateforme sur chaque livraison</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="min_transporter_fee" class="form-label">Tarif minimum transporteur (FCFA)</label>
                                <div class="input-group">
                                    <span class="input-group-text">FCFA</span>
                                    <input type="number" step="100" min="0" class="form-control" id="min_transporter_fee" 
                                        name="min_transporter_fee" value="<?= $settings['min_transporter_fee'] ?>" required>
                                </div>
                                <small class="text-muted">Montant minimum qu'un transporteur peut proposer</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Paramètres de livraison</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="max_shipment_weight" class="form-label">Poids maximum (kg)</label>
                                <div class="input-group">
                                    <input type="number" step="0.1" min="0" class="form-control" id="max_shipment_weight" 
                                        name="max_shipment_weight" value="<?= $settings['max_shipment_weight'] ?>" required>
                                    <span class="input-group-text">kg</span>
                                </div>
                                <small class="text-muted">Poids maximum accepté pour une livraison</small>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="default_deadline_days" class="form-label">Délai par défaut (jours)</label>
                                <div class="input-group">
                                    <input type="number" min="1" max="30" class="form-control" id="default_deadline_days" 
                                        name="default_deadline_days" value="<?= $settings['default_deadline_days'] ?>" required>
                                    <span class="input-group-text">jours</span>
                                </div>
                                <small class="text-muted">Délai de livraison par défaut si non spécifié</small>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Notifications</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="notify_new_shipments" 
                                name="notify_new_shipments" <?= $settings['notify_new_shipments'] ? 'checked' : '' ?>>
                            <label class="form-check-label" for="notify_new_shipments">Notifier les transporteurs des nouvelles livraisons</label>
                        </div>
                        
                        <div class="mb-3 form-check form-switch">
                            <input class="form-check-input" type="checkbox" id="notify_disputes" 
                                name="notify_disputes" <?= $settings['notify_disputes'] ? 'checked' : '' ?>>
                            <label class="form-check-label" for="notify_disputes">Notifier les administrateurs des nouveaux litiges</label>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">Coordonnées</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="admin_email" class="form-label">Email administrateur</label>
                                <input type="email" class="form-control" id="admin_email" 
                                    name="admin_email" value="<?= htmlspecialchars($settings['admin_email']) ?>" required>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="support_phone" class="form-label">Téléphone support</label>
                                <input type="tel" class="form-control" id="support_phone" 
                                    name="support_phone" value="<?= htmlspecialchars($settings['support_phone']) ?>" required>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-end">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-1"></i> Enregistrer les modifications
                    </button>
                </div>
            </form>
        </main>
    </div>
</div>

<?php include '../includes/footer.php'; ?>
7. Admin Sidebar (admin_sidebar.php)
php
<div class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
    <div class="position-sticky pt-3">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link <?= basename($_SERVER['PHP_SELF']) === 'dashboard.php' ? 'active' : '' ?>" href="dashboard.php">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Tableau de bord
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?= basename($_SERVER['PHP_SELF']) === 'gestion_transporteurs.php' ? 'active' : '' ?>" href="gestion_transporteurs.php">
                    <i class="fas fa-truck me-2"></i>
                    Transporteurs
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?= basename($_SERVER['PHP_SELF']) === 'gestion_commandes.php' ? 'active' : '' ?>" href="gestion_commandes.php">
                    <i class="fas fa-boxes me-2"></i>
                    Livraisons
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?= basename($_SERVER['PHP_SELF']) === 'disputes.php' ? 'active' : '' ?>" href="disputes.php">
                    <i class="fas fa-gavel me-2"></i>
                    Litiges
                    <span class="badge bg-danger rounded-pill float-end">3</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?= basename($_SERVER['PHP_SELF']) === 'rapports.php' ? 'active' : '' ?>" href="rapports.php">
                    <i class="fas fa-chart-bar me-2"></i>
                    Rapports
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?= basename($_SERVER['PHP_SELF']) === 'parametres.php' ? 'active' : '' ?>" href="parametres.php">
                    <i class="fas fa-cog me-2"></i>
                    Paramètres
                </a>
            </li>
        </ul>
        
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Actions rapides</span>
        </h6>
        <ul class="nav flex-column mb-2">
            <li class="nav-item">
                <a class="nav-link" href="gestion_transporteurs.php?filter=pending">
                    <i class="fas fa-user-clock me-2"></i>
                    Transporteurs en attente
                    <span class="badge bg-warning rounded-pill float-end">5</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="gestion_commandes.php?filter=active">
                    <i class="fas fa-shipping-fast me-2"></i>
                    Livraisons actives
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="disputes.php?filter=open">
                    <i class="fas fa-exclamation-circle me-2"></i>
                    Litiges non résolus
                </a>
            </li>
        </ul>
    </div>
</div>

includes directory:

. config.php
php
<?php
// Configuration de base
define('SITE_NAME', 'Transporteur Provincial Gabonais');
define('SITE_URL', 'http://localhost/transporteur-provincial-gabonais');
define('ADMIN_EMAIL', 'admin@tpg.ga');
define('SUPPORT_PHONE', '+241 01 23 45 67');

// Paramètres de base de données
define('DB_HOST', 'localhost');
define('DB_NAME', 'transporteur_provincial');
define('DB_USER', 'root');
define('DB_PASS', '');

// Paramètres de session
define('SESSION_TIMEOUT', 3600); // 1 heure
define('SESSION_NAME', 'TPG_SESSION');

// Configuration MPG
define('MPG_API_URL', 'https://marcheprovincial.ga/api/v1');
define('MPG_API_KEY', 'YOUR_MPG_API_KEY');

// Paramètres de plateforme
define('PLATFORM_FEE', 0.15); // 15%
define('MIN_TRANSPORTER_FEE', 5000); // 5000 FCFA
define('MAX_SHIPMENT_WEIGHT', 1000); // 1000 kg
define('DEFAULT_DEADLINE_DAYS', 7); // 7 jours

// Autres configurations
define('MAX_FILE_SIZE', 5 * 1024 * 1024); // 5MB
define('UPLOAD_DIR', __DIR__ . '/../uploads');
define('LOG_DIR', __DIR__ . '/../logs');

// Niveaux de log
define('LOG_LEVEL_ERROR', 1);
define('LOG_LEVEL_WARNING', 2);
define('LOG_LEVEL_INFO', 3);
define('LOG_LEVEL_DEBUG', 4);

// Timezone
date_default_timezone_set('Africa/Libreville');

// Activer les erreurs en développement
if ($_SERVER['SERVER_NAME'] === 'localhost') {
    error_reporting(E_ALL);
    ini_set('display_errors', 1);
} else {
    error_reporting(0);
    ini_set('display_errors', 0);
}
?>
2. db_connect.php
php
<?php
require_once 'config.php';

/**
 * Établit une connexion à la base de données
 * @return PDO L'objet de connexion PDO
 */
function getDB() {
    static $db = null;
    
    if ($db === null) {
        try {
            $dsn = 'mysql:host=' . DB_HOST . ';dbname=' . DB_NAME . ';charset=utf8';
            $db = new PDO($dsn, DB_USER, DB_PASS);
            $db->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
            $db->setAttribute(PDO::ATTR_DEFAULT_FETCH_MODE, PDO::FETCH_ASSOC);
            $db->setAttribute(PDO::ATTR_EMULATE_PREPARES, false);
        } catch (PDOException $e) {
            logError('Database connection failed: ' . $e->getMessage());
            die('Une erreur est survenue lors de la connexion à la base de données.');
        }
    }
    
    return $db;
}

/**
 * Log une erreur dans le fichier de log
 * @param string $message Message d'erreur
 * @param int $level Niveau de log (par défaut ERROR)
 */
function logError($message, $level = LOG_LEVEL_ERROR) {
    $logLevels = [
        LOG_LEVEL_ERROR => 'ERROR',
        LOG_LEVEL_WARNING => 'WARNING',
        LOG_LEVEL_INFO => 'INFO',
        LOG_LEVEL_DEBUG => 'DEBUG'
    ];
    
    $timestamp = date('Y-m-d H:i:s');
    $levelStr = $logLevels[$level] ?? 'UNKNOWN';
    $logMessage = "[$timestamp] [$levelStr] $message" . PHP_EOL;
    
    if (!file_exists(LOG_DIR)) {
        mkdir(LOG_DIR, 0755, true);
    }
    
    $logFile = LOG_DIR . '/app_' . date('Y-m-d') . '.log';
    file_put_contents($logFile, $logMessage, FILE_APPEND);
}
?>
3. functions.php
php
<?php
require_once 'config.php';
require_once 'db_connect.php';

/**
 * Formate une date pour l'affichage
 * @param string $date Date à formater
 * @param bool $showTime Afficher l'heure
 * @return string Date formatée
 */
function formatDate($date, $showTime = false) {
    if (empty($date) || $date === '0000-00-00') {
        return 'N/A';
    }
    
    $format = $showTime ? 'd/m/Y H:i' : 'd/m/Y';
    return date($format, strtotime($date));
}

/**
 * Formate une date avec l'heure
 * @param string $date Date à formater
 * @return string Date formatée avec heure
 */
function formatDateTime($date) {
    return formatDate($date, true);
}

/**
 * Formate un montant en devise
 * @param float $amount Montant à formater
 * @return string Montant formaté
 */
function formatCurrency($amount) {
    return number_format($amount, 0, ',', ' ') . ' FCFA';
}

/**
 * Récupère le nom d'une province par son ID
 * @param int $provinceId ID de la province
 * @return string Nom de la province
 */
function getProvinceName($provinceId) {
    $db = getDB();
    $stmt = $db->prepare("SELECT nom FROM provinces WHERE id = ?");
    $stmt->execute([$provinceId]);
    $province = $stmt->fetch();
    
    return $province ? $province['nom'] : 'Inconnue';
}

/**
 * Récupère toutes les provinces
 * @return array Tableau des provinces [id => nom]
 */
function getProvinces() {
    $db = getDB();
    $stmt = $db->query("SELECT id, nom FROM provinces ORDER BY nom");
    $provinces = $stmt->fetchAll();
    
    $result = [];
    foreach ($provinces as $province) {
        $result[$province['id']] = $province['nom'];
    }
    
    return $result;
}

/**
 * Récupère le texte du statut d'un transporteur
 * @param string $status Statut
 * @return string Texte du statut
 */
function getTransporterStatusText($status) {
    $statuses = [
        'en_attente' => 'En attente',
        'approuve' => 'Approuvé',
        'rejete' => 'Rejeté',
        'banni' => 'Banni'
    ];
    
    return $statuses[$status] ?? $status;
}

/**
 * Récupère le texte du statut d'une livraison
 * @param string $status Statut
 * @return string Texte du statut
 */
function getShipmentStatusText($status) {
    $statuses = [
        'en_attente' => 'En attente',
        'en_preparation' => 'En préparation',
        'en_route' => 'En route',
        'livre' => 'Livré',
        'retarde' => 'Retardé',
        'annule' => 'Annulé'
    ];
    
    return $statuses[$status] ?? $status;
}

/**
 * Met à jour le statut d'un transporteur
 * @param int $transporterId ID du transporteur
 * @param string $status Nouveau statut
 * @return bool Succès de l'opération
 */
function updateTransporterStatus($transporterId, $status) {
    $db = getDB();
    $stmt = $db->prepare("UPDATE transporteurs SET statut = ? WHERE id = ?");
    return $stmt->execute([$status, $transporterId]);
}

/**
 * Met à jour le statut d'une livraison
 * @param int $shipmentId ID de la livraison
 * @param string $status Nouveau statut
 * @param string $notes Notes supplémentaires
 * @return bool Succès de l'opération
 */
function updateShipmentStatus($shipmentId, $status, $notes = '') {
    $db = getDB();
    
    try {
        $db->beginTransaction();
        
        // Mettre à jour le statut de la marchandise
        $stmt = $db->prepare("UPDATE marchandises SET statut = ? WHERE id = ?");
        $stmt->execute([$status, $shipmentId]);
        
        // Mettre à jour le statut de l'affectation
        $stmt = $db->prepare("UPDATE affectations_transport SET statut = ? WHERE marchandise_id = ?");
        $stmt->execute([$status, $shipmentId]);
        
        // Si la livraison est marquée comme livrée, mettre à jour la date de livraison
        if ($status === 'livre') {
            $stmt = $db->prepare("UPDATE affectations_transport SET date_livraison = NOW() WHERE marchandise_id = ?");
            $stmt->execute([$shipmentId]);
        }
        
        // Ajouter une note si fournie
        if (!empty($notes)) {
            $stmt = $db->prepare("INSERT INTO notes_livraison (marchandise_id, note, created_at) VALUES (?, ?, NOW())");
            $stmt->execute([$shipmentId, $notes]);
        }
        
        $db->commit();
        return true;
    } catch (PDOException $e) {
        $db->rollBack();
        logError("Failed to update shipment status: " . $e->getMessage());
        return false;
    }
}

/**
 * Résout un litige
 * @param int $disputeId ID du litige
 * @param string $resolution Décision de résolution
 * @param string $notes Notes supplémentaires
 * @return bool Succès de l'opération
 */
function resolveDispute($disputeId, $resolution, $notes = '') {
    $db = getDB();
    $stmt = $db->prepare("UPDATE litiges SET statut = 'resolu', resolution = ?, resolution_notes = ?, resolved_at = NOW() WHERE id = ?");
    return $stmt->execute([$resolution, $notes, $disputeId]);
}

/**
 * Récupère les statistiques pour le tableau de bord
 * @return array Tableau de statistiques
 */
function getDashboardStats() {
    $db = getDB();
    
    $stats = [
        'total_transporters' => 0,
        'pending_transporters' => 0,
        'active_shipments' => 0,
        'completed_shipments' => 0,
        'revenue' => 0,
        'disputes' => 0
    ];
    
    // Total des transporteurs
    $stmt = $db->query("SELECT COUNT(*) FROM transporteurs");
    $stats['total_transporters'] = $stmt->fetchColumn();
    
    // Transporteurs en attente
    $stmt = $db->query("SELECT COUNT(*) FROM transporteurs WHERE statut = 'en_attente'");
    $stats['pending_transporters'] = $stmt->fetchColumn();
    
    // Livraisons actives
    $stmt = $db->query("SELECT COUNT(*) FROM affectations_transport WHERE statut IN ('en_preparation', 'en_route')");
    $stats['active_shipments'] = $stmt->fetchColumn();
    
    // Livraisons complétées ce mois
    $stmt = $db->query("SELECT COUNT(*) FROM affectations_transport 
                        WHERE statut = 'livre' AND MONTH(date_livraison) = MONTH(CURRENT_DATE())");
    $stats['completed_shipments'] = $stmt->fetchColumn();
    
    // Revenus ce mois
    $stmt = $db->query("SELECT SUM(prix * " . PLATFORM_FEE . ") FROM offres_transport 
                        WHERE statut = 'accepte' AND MONTH(created_at) = MONTH(CURRENT_DATE())");
    $stats['revenue'] = $stmt->fetchColumn() ?? 0;
    
    // Litiges non résolus
    $stmt = $db->query("SELECT COUNT(*) FROM litiges WHERE statut = 'open'");
    $stats['disputes'] = $stmt->fetchColumn();
    
    return $stats;
}

/**
 * Récupère les activités récentes
 * @param int $limit Nombre maximum d'activités à retourner
 * @return array Tableau d'activités
 */
function getRecentActivities($limit = 10) {
    $db = getDB();
    $stmt = $db->prepare("SELECT * FROM activites ORDER BY created_at DESC LIMIT ?");
    $stmt->bindValue(1, $limit, PDO::PARAM_INT);
    $stmt->execute();
    
    return $stmt->fetchAll();
}

/**
 * Log une activité
 * @param string $action Description de l'action
 * @param string $details Détails supplémentaires
 * @return bool Succès de l'opération
 */
function logActivity($action, $details = '') {
    $db = getDB();
    $userId = $_SESSION['user_id'] ?? null;
    
    $stmt = $db->prepare("INSERT INTO activites (user_id, action, details) VALUES (?, ?, ?)");
    return $stmt->execute([$userId, $action, $details]);
}

/**
 * Récupère les transporteurs selon un filtre
 * @param string $filter Filtre (all, pending, approved, banned)
 * @return array Tableau de transporteurs
 */
function getTransporters($filter = 'all') {
    $db = getDB();
    
    $query = "SELECT t.*, u.prenom, u.nom, u.email, u.telephone, 
              GROUP_CONCAT(p.nom SEPARATOR ',') AS provinces
              FROM transporteurs t
              JOIN users u ON t.user_id = u.id
              LEFT JOIN routes_transporteur rt ON rt.transporteur_id = t.id
              LEFT JOIN provinces p ON p.id = rt.province_depart_id
              WHERE 1=1";
    
    switch ($filter) {
        case 'pending':
            $query .= " AND t.statut = 'en_attente'";
            break;
        case 'approved':
            $query .= " AND t.statut = 'approuve'";
            break;
        case 'banned':
            $query .= " AND t.statut = 'banni'";
            break;
    }
    
    $query .= " GROUP BY t.id
                ORDER BY t.created_at DESC";
    
    $stmt = $db->query($query);
    return $stmt->fetchAll();
}

/**
 * Récupère les livraisons selon des filtres
 * @param string $filter Filtre de statut
 * @param string $province Filtre de province
 * @param int|null $transporterId Filtre de transporteur
 * @param string $search Terme de recherche
 * @return array Tableau de livraisons
 */
function getShipments($filter = 'all', $province = 'all', $transporterId = null, $search = '') {
    $db = getDB();
    
    $query = "SELECT m.id, m.nom AS nom_marchandise, m.poids_kg, m.dimensions, 
              m.adresse_ramassage, m.adresse_livraison, m.date_limite, m.statut,
              p.nom AS province_depart, 
              t.id AS transporteur_id, CONCAT(u.prenom, ' ', u.nom) AS transporteur_nom, 
              t.type_vehicule, 
              at.date_depart, at.date_livraison, 
              ot.prix
              FROM marchandises m
              JOIN provinces p ON m.province_depart_id = p.id
              LEFT JOIN affectations_transport at ON at.marchandise_id = m.id
              LEFT JOIN offres_transport ot ON ot.id = at.offre_id
              LEFT JOIN transporteurs t ON t.id = ot.transporteur_id
              LEFT JOIN users u ON u.id = t.user_id
              WHERE 1=1";
    
    // Filtre par statut
    switch ($filter) {
        case 'active':
            $query .= " AND at.statut IN ('en_preparation', 'en_route')";
            break;
        case 'completed':
            $query .= " AND at.statut = 'livre'";
            break;
        case 'pending':
            $query .= " AND m.statut = 'en_attente'";
            break;
        case 'preparation':
            $query .= " AND at.statut = 'en_preparation'";
            break;
        case 'transit':
            $query .= " AND at.statut = 'en_route'";
            break;
        case 'delivered':
            $query .= " AND at.statut = 'livre'";
            break;
        case 'delayed':
            $query .= " AND at.statut = 'retarde'";
            break;
        case 'canceled':
            $query .= " AND at.statut = 'annule'";
            break;
    }
    
    // Filtre par province
    if ($province !== 'all') {
        $query .= " AND m.province_depart_id = " . intval($province);
    }
    
    // Filtre par transporteur
    if ($transporterId !== null) {
        $query .= " AND t.id = " . intval($transporterId);
    }
    
    // Filtre par recherche
    if (!empty($search)) {
        $search = $db->quote('%' . $search . '%');
        $query .= " AND (m.nom LIKE $search OR CONCAT(u.prenom, ' ', u.nom) LIKE $search)";
    }
    
    $query .= " ORDER BY m.date_limite ASC";
    
    $stmt = $db->query($query);
    return $stmt->fetchAll();
}

/**
 * Récupère les litiges
 * @return array Tableau de litiges
 */
function getDisputes() {
    $db = getDB();
    
    $query = "SELECT d.id, d.shipment_id, d.reason, d.details, d.status, 
              d.created_at, d.resolved_at, d.resolution, d.resolution_notes,
              m.nom AS product_name,
              u.id AS user_id, CONCAT(u.prenom, ' ', u.nom) AS user_name, u.role AS user_role
              FROM litiges d
              JOIN marchandises m ON m.id = d.shipment_id
              JOIN users u ON u.id = d.user_id
              ORDER BY d.created_at DESC";
    
    $stmt = $db->query($query);
    return $stmt->fetchAll();
}

/**
 * Récupère les données pour les rapports
 * @param string $reportType Type de rapport
 * @param string $startDate Date de début
 * @param string $endDate Date de fin
 * @param string $province Filtre de province
 * @return array Données du rapport
 */
function getReportData($reportType, $startDate, $endDate, $province = 'all') {
    $db = getDB();
    $data = [
        'total_shipments' => 0,
        'completed_shipments' => 0,
        'total_revenue' => 0,
        'platform_earnings' => 0,
        'active_transporters' => 0,
        'new_transporters' => 0,
        'chart_labels' => [],
        'total_data' => [],
        'completed_data' => [],
        'province_labels' => [],
        'province_data' => [],
        'top_transporters' => [],
        'shipment_details' => []
    ];
    
    // Dates de début et fin
    $startDate = $db->quote($startDate);
    $endDate = $db->quote($endDate);
    
    // Total des livraisons
    $query = "SELECT COUNT(*) FROM marchandises 
              WHERE created_at BETWEEN $startDate AND $endDate";
    $data['total_shipments'] = $db->query($query)->fetchColumn();
    
    // Livraisons complétées
    $query = "SELECT COUNT(*) FROM affectations_transport 
              WHERE statut = 'livre' AND date_livraison BETWEEN $startDate AND $endDate";
    $data['completed_shipments'] = $db->query($query)->fetchColumn();
    
    // Revenus totaux
    $query = "SELECT SUM(prix) FROM offres_transport 
              WHERE statut = 'accepte' AND created_at BETWEEN $startDate AND $endDate";
    $data['total_revenue'] = $db->query($query)->fetchColumn() ?? 0;
    
    // Gains de la plateforme
    $data['platform_earnings'] = $data['total_revenue'] * PLATFORM_FEE;
    
    // Transporteurs actifs
    $query = "SELECT COUNT(DISTINCT transporteur_id) FROM affectations_transport 
              WHERE date_depart BETWEEN $startDate AND $endDate";
    $data['active_transporters'] = $db->query($query)->fetchColumn();
    
    // Nouveaux transporteurs
    $query = "SELECT COUNT(*) FROM transporteurs 
              WHERE created_at BETWEEN $startDate AND $endDate";
    $data['new_transporters'] = $db->query($query)->fetchColumn();
    
    // Données pour le graphique selon le type de rapport
    switch ($reportType) {
        case 'weekly':
            // Données hebdomadaires
            $query = "SELECT 
                      YEARWEEK(created_at) AS week,
                      COUNT(*) AS total,
                      SUM(CASE WHEN m.statut = 'livre' THEN 1 ELSE 0 END) AS completed
                      FROM marchandises m
                      WHERE m.created_at BETWEEN $startDate AND $endDate
                      GROUP BY YEARWEEK(created_at)
                      ORDER BY YEARWEEK(created_at)";
            
            $stmt = $db->query($query);
            $weeklyData = $stmt->fetchAll();
            
            foreach ($weeklyData as $week) {
                $data['chart_labels'][] = 'S' . substr($week['week'], 4);
                $data['total_data'][] = $week['total'];
                $data['completed_data'][] = $week['completed'];
            }
            break;
            
        case 'daily':
            // Données quotidiennes
            $query = "SELECT 
                      DATE(created_at) AS day,
                      COUNT(*) AS total,
                      SUM(CASE WHEN m.statut = 'livre' THEN 1 ELSE 0 END) AS completed
                      FROM marchandises m
                      WHERE m.created_at BETWEEN $startDate AND $endDate
                      GROUP BY DATE(created_at)
                      ORDER BY DATE(created_at)";
            
            $stmt = $db->query($query);
            $dailyData = $stmt->fetchAll();
            
            foreach ($dailyData as $day) {
                $data['chart_labels'][] = date('d/m', strtotime($day['day']));
                $data['total_data'][] = $day['total'];
                $data['completed_data'][] = $day['completed'];
            }
            break;
            
        default:
            // Données mensuelles par défaut
            $query = "SELECT 
                      DATE_FORMAT(created_at, '%Y-%m') AS month,
                      COUNT(*) AS total,
                      SUM(CASE WHEN m.statut = 'livre' THEN 1 ELSE 0 END) AS completed
                      FROM marchandises m
                      WHERE m.created_at BETWEEN $startDate AND $endDate
                      GROUP BY DATE_FORMAT(created_at, '%Y-%m')
                      ORDER BY DATE_FORMAT(created_at, '%Y-%m')";
            
            $stmt = $db->query($query);
            $monthlyData = $stmt->fetchAll();
            
            foreach ($monthlyData as $month) {
                $data['chart_labels'][] = date('M Y', strtotime($month['month'] . '-01'));
                $data['total_data'][] = $month['total'];
                $data['completed_data'][] = $month['completed'];
            }
    }
    
    // Répartition par province
    $query = "SELECT p.nom, COUNT(*) AS count 
              FROM marchandises m
              JOIN provinces p ON p.id = m.province_depart_id
              WHERE m.created_at BETWEEN $startDate AND $endDate
              GROUP BY p.nom
              ORDER BY count DESC";
    
    $stmt = $db->query($query);
    $provinceData = $stmt->fetchAll();
    
    foreach ($provinceData as $province) {
        $data['province_labels'][] = $province['nom'];
        $data['province_data'][] = $province['count'];
    }
    
    // Top transporteurs
    $query = "SELECT 
              t.id, CONCAT(u.prenom, ' ', u.nom) AS name,
              COUNT(*) AS shipments,
              SUM(ot.prix) AS earnings,
              AVG(r.rating) AS rating
              FROM affectations_transport at
              JOIN transporteurs t ON t.id = at.transporteur_id
              JOIN users u ON u.id = t.user_id
              JOIN offres_transport ot ON ot.id = at.offre_id
              LEFT JOIN evaluations r ON r.transporteur_id = t.id
              WHERE at.date_depart BETWEEN $startDate AND $endDate
              GROUP BY t.id, u.prenom, u.nom
              ORDER BY shipments DESC
              LIMIT 5";
    
    $stmt = $db->query($query);
    $data['top_transporters'] = $stmt->fetchAll();
    
    // Détails des livraisons
    $query = "SELECT 
              m.id, DATE(m.created_at) AS date, m.nom AS product_name,
              p.nom AS province, 
              CONCAT(u.prenom, ' ', u.nom) AS transporter_name,
              at.statut AS status, ot.prix AS price
              FROM marchandises m
              JOIN provinces p ON p.id = m.province_depart_id
              LEFT JOIN affectations_transport at ON at.marchandise_id = m.id
              LEFT JOIN offres_transport ot ON ot.id = at.offre_id
              LEFT JOIN transporteurs t ON t.id = ot.transporteur_id
              LEFT JOIN users u ON u.id = t.user_id
              WHERE m.created_at BETWEEN $startDate AND $endDate
              ORDER BY m.created_at DESC
              LIMIT 10";
    
    $stmt = $db->query($query);
    $data['shipment_details'] = $stmt->fetchAll();
    
    return $data;
}

/**
 * Récupère les paramètres de la plateforme
 * @return array Tableau de paramètres
 */
function getSettings() {
    return [
        'platform_fee' => PLATFORM_FEE,
        'min_transporter_fee' => MIN_TRANSPORTER_FEE,
        'max_shipment_weight' => MAX_SHIPMENT_WEIGHT,
        'default_deadline_days' => DEFAULT_DEADLINE_DAYS,
        'notify_new_shipments' => true,
        'notify_disputes' => true,
        'admin_email' => ADMIN_EMAIL,
        'support_phone' => SUPPORT_PHONE
    ];
}

/**
 * Met à jour les paramètres de la plateforme
 * @param array $settings Nouveaux paramètres
 * @return bool Succès de l'opération
 */
function updateSettings($settings) {
    // Dans une vraie application, on sauvegarderait ces paramètres en base de données
    // Pour cet exemple, on simule juste la mise à jour
    return true;
}

/**
 * Enregistre un nouvel utilisateur
 * @param array $data Données de l'utilisateur
 * @return bool|string True en cas de succès, message d'erreur sinon
 */
function registerUser($data) {
    $db = getDB();
    
    // Validation des données
    if (empty($data['prenom']) {
        return "Le prénom est requis";
    }
    
    if (empty($data['nom'])) {
        return "Le nom est requis";
    }
    
    if (empty($data['email']) || !filter_var($data['email'], FILTER_VALIDATE_EMAIL)) {
        return "Email invalide";
    }
    
    if (empty($data['telephone'])) {
        return "Le téléphone est requis";
    }
    
    if (empty($data['password']) || strlen($data['password']) < 6) {
        return "Le mot de passe doit contenir au moins 6 caractères";
    }
    
    if ($data['password'] !== $data['confirm_password']) {
        return "Les mots de passe ne correspondent pas";
    }
    
    // Vérifier si l'email existe déjà
    $stmt = $db->prepare("SELECT id FROM users WHERE email = ?");
    $stmt->execute([$data['email']]);
    
    if ($stmt->fetch()) {
        return "Cet email est déjà utilisé";
    }
    
    try {
        $db->beginTransaction();
        
        // Créer l'utilisateur
        $stmt = $db->prepare("INSERT INTO users (prenom, nom, email, telephone, password, role) 
                             VALUES (?, ?, ?, ?, ?, 'client')");
        $hashedPassword = password_hash($data['password'], PASSWORD_DEFAULT);
        $stmt->execute([
            $data['prenom'],
            $data['nom'],
            $data['email'],
            $data['telephone'],
            $hashedPassword
        ]);
        
        $userId = $db->lastInsertId();
        
        // Si c'est un transporteur, créer le profil transporteur
        if (isset($data['type_vehicule'])) {
            $stmt = $db->prepare("INSERT INTO transporteurs 
                                 (user_id, type_vehicule, capacite_kg, plaque_immatriculation, permis_numero) 
                                 VALUES (?, ?, ?, ?, ?)");
            $stmt->execute([
                $userId,
                $data['type_vehicule'],
                $data['capacite_kg'],
                $data['plaque_immatriculation'],
                $data['permis_numero']
            ]);
            
            // Ajouter les provinces desservies
            if (!empty($data['provinces'])) {
                $transporteurId = $db->lastInsertId();
                
                foreach ($data['provinces'] as $provinceId) {
                    $stmt = $db->prepare("INSERT INTO routes_transporteur 
                                         (transporteur_id, province_depart_id, province_arrivee_id) 
                                         VALUES (?, ?, (SELECT id FROM provinces WHERE nom = 'Estuaire'))");
                    $stmt->execute([$transporteurId, $provinceId]);
                }
            }
        }
        
        $db->commit();
        return true;
    } catch (PDOException $e) {
        $db->rollBack();
        logError("User registration failed: " . $e->getMessage());
        return "Une erreur est survenue lors de l'inscription";
    }
}

/**
 * Enregistre un nouveau transporteur
 * @param array $data Données du transporteur
 * @return bool|string True en cas de succès, message d'erreur sinon
 */
function registerTransporter($data) {
    return registerUser($data);
}

/**
 * Vérifie si l'utilisateur est connecté
 * @return bool True si connecté, false sinon
 */
function isLoggedIn() {
    return isset($_SESSION['user_id']);
}

/**
 * Vérifie si l'utilisateur est un administrateur
 * @return bool True si admin, false sinon
 */
function isAdmin() {
    return isset($_SESSION['user_role']) && $_SESSION['user_role'] === 'admin';
}

/**
 * Vérifie si l'utilisateur est un transporteur
 * @return bool True si transporteur, false sinon
 */
function isTransporter() {
    return isset($_SESSION['user_role']) && $_SESSION['user_role'] === 'transporteur';
}

/**
 * Vérifie si l'utilisateur est un client
 * @return bool True si client, false sinon
 */
function isClient() {
    return isset($_SESSION['user_role']) && $_SESSION['user_role'] === 'client';
}

/**
 * Redirige l'utilisateur s'il n'est pas connecté
 * @param string $redirectUrl URL de redirection
 */
function requireLogin($redirectUrl = '/connexion.php') {
    if (!isLoggedIn()) {
        header("Location: $redirectUrl");
        exit();
    }
}

/**
 * Redirige l'utilisateur s'il n'est pas admin
 * @param string $redirectUrl URL de redirection
 */
function requireAdmin($redirectUrl = '/connexion.php') {
    requireLogin($redirectUrl);
    
    if (!isAdmin()) {
        header("Location: $redirectUrl");
        exit();
    }
}

/**
 * Redirige l'utilisateur s'il n'est pas transporteur
 * @param string $redirectUrl URL de redirection
 */
function requireTransporter($redirectUrl = '/connexion.php') {
    requireLogin($redirectUrl);
    
    if (!isTransporter()) {
        header("Location: $redirectUrl");
        exit();
    }
}

/**
 * Redirige l'utilisateur s'il n'est pas client
 * @param string $redirectUrl URL de redirection
 */
function requireClient($redirectUrl = '/connexion.php') {
    requireLogin($redirectUrl);
    
    if (!isClient()) {
        header("Location: $redirectUrl");
        exit();
    }
}

/**
 * Nettoie les données utilisateur
 * @param string $data Donnée à nettoyer
 * @return string Donnée nettoyée
 */
function sanitizeInput($data) {
    return htmlspecialchars(strip_tags(trim($data)));
}
?>
4. auth.php
php
<?php
require_once 'config.php';
require_once 'functions.php';

// Démarrer la session
if (session_status() === PHP_SESSION_NONE) {
    session_name(SESSION_NAME);
    session_start();
}

/**
 * Connecte un utilisateur
 * @param string $email Email de l'utilisateur
 * @param string $password Mot de passe
 * @return bool|string True en cas de succès, message d'erreur sinon
 */
function loginUser($email, $password) {
    $db = getDB();
    
    $stmt = $db->prepare("SELECT id, prenom, nom, email, password, role FROM users WHERE email = ?");
    $stmt->execute([$email]);
    $user = $stmt->fetch();
    
    if (!$user) {
        return "Email ou mot de passe incorrect";
    }
    
    if (!password_verify($password, $user['password'])) {
        return "Email ou mot de passe incorrect";
    }
    
    // Créer la session
    $_SESSION['user_id'] = $user['id'];
    $_SESSION['user_name'] = $user['prenom'] . ' ' . $user['nom'];
    $_SESSION['user_email'] = $user['email'];
    $_SESSION['user_role'] = $user['role'];
    $_SESSION['last_activity'] = time();
    
    // Si c'est un transporteur, vérifier s'il est approuvé
    if ($user['role'] === 'transporteur') {
        $stmt = $db->prepare("SELECT statut FROM transporteurs WHERE user_id = ?");
        $stmt->execute([$user['id']]);
        $transporter = $stmt->fetch();
        
        if ($transporter['statut'] !== 'approuve') {
            return "Votre compte transporteur est en attente d'approbation";
        }
    }
    
    return true;
}

/**
 * Déconnecte l'utilisateur
 */
function logoutUser() {
    // Détruire la session
    $_SESSION = [];
    session_destroy();
    
    // Rediriger vers la page de connexion
    header("Location: /connexion.php");
    exit();
}

/**
 * Vérifie si la session a expiré
 */
function checkSessionTimeout() {
    if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity'] > SESSION_TIMEOUT)) {
        logoutUser();
    }
    
    // Mettre à jour le temps de la dernière activité
    $_SESSION['last_activity'] = time();
}

/**
 * Vérifie les tentatives de connexion et bloque si nécessaire
 * @param string $email Email de l'utilisateur
 * @return bool True si autorisé à tenter de se connecter, false sinon
 */
function checkLoginAttempts($email) {
    $db = getDB();
    
    // Vérifier les tentatives récentes (dernières 15 minutes)
    $stmt = $db->prepare("SELECT COUNT(*) FROM login_attempts 
                         WHERE email = ? AND attempt_time > DATE_SUB(NOW(), INTERVAL 15 MINUTE)");
    $stmt->execute([$email]);
    $attempts = $stmt->fetchColumn();
    
    return $attempts < 5;
}

/**
 * Enregistre une tentative de connexion
 * @param string $email Email de l'utilisateur
 * @param bool $success Succès de la tentative
 */
function logLoginAttempt($email, $success) {
    $db = getDB();
    
    $stmt = $db->prepare("INSERT INTO login_attempts (email, success, attempt_time) VALUES (?, ?, NOW())");
    $stmt->execute([$email, $success ? 1 : 0]);
}

/**
 * Génère un token de réinitialisation de mot de passe
 * @param string $email Email de l'utilisateur
 * @return string Token généré
 */
function generatePasswordResetToken($email) {
    $db = getDB();
    
    // Vérifier que l'email existe
    $stmt = $db->prepare("SELECT id FROM users WHERE email = ?");
    $stmt->execute([$email]);
    
    if (!$stmt->fetch()) {
        return false;
    }
    
    // Générer un token unique
    $token = bin2hex(random_bytes(32));
    $expires = date('Y-m-d H:i:s', strtotime('+1 hour'));
    
    // Stocker le token en base de données
    $stmt = $db->prepare("INSERT INTO password_resets (email, token, expires_at) VALUES (?, ?, ?)");
    $stmt->execute([$email, $token, $expires]);
    
    return $token;
}

/**
 * Vérifie un token de réinitialisation de mot de passe
 * @param string $token Token à vérifier
 * @return bool|string Email associé si valide, false sinon
 */
function verifyPasswordResetToken($token) {
    $db = getDB();
    
    $stmt = $db->prepare("SELECT email FROM password_resets WHERE token = ? AND expires_at > NOW()");
    $stmt->execute([$token]);
    $result = $stmt->fetch();
    
    return $result ? $result['email'] : false;
}

/**
 * Réinitialise le mot de passe d'un utilisateur
 * @param string $email Email de l'utilisateur
 * @param string $password Nouveau mot de passe
 * @return bool Succès de l'opération
 */
function resetPassword($email, $password) {
    $db = getDB();
    
    try {
        $db->beginTransaction();
        
        // Mettre à jour le mot de passe
        $hashedPassword = password_hash($password, PASSWORD_DEFAULT);
        $stmt = $db->prepare("UPDATE users SET password = ? WHERE email = ?");
        $stmt->execute([$hashedPassword, $email]);
        
        // Supprimer le token
        $stmt = $db->prepare("DELETE FROM password_resets WHERE email = ?");
        $stmt->execute([$email]);
        
        $db->commit();
        return true;
    } catch (PDOException $e) {
        $db->rollBack();
        logError("Password reset failed: " . $e->getMessage());
        return false;
    }
}

// Vérifier le timeout de session à chaque chargement de page
checkSessionTimeout();
?>
5. mpg_integration.php
php
<?php
require_once 'config.php';
require_once 'db_connect.php';

class MPGIntegration {
    private $mpg_api_url;
    private $api_key;
    
    public function __construct() {
        $this->mpg_api_url = MPG_API_URL;
        $this->api_key = MPG_API_KEY;
    }
    
    /**
     * Récupère les produits nécessitant un transport depuis MPG
     * @return array Tableau de produits
     */
    public function getProductsNeedingTransport() {
        try {
            $db = getDB();
            
            // D'abord vérifier notre base de données locale pour les produits en cache
            $stmt = $db->prepare("SELECT * FROM marchandises WHERE statut = 'en_attente'");
            $stmt->execute();
            $local_products = $stmt->fetchAll(PDO::FETCH_ASSOC);
            
            if (count($local_products) > 0) {
                return $local_products;
            }
            
            // Si aucun en local, récupérer depuis l'API MPG
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, $this->mpg_api_url.'/products/needing-transport');
            curl_setopt($ch, CURLOPT_HTTPHEADER, [
                'Authorization: Bearer '.$this->api_key,
                'Accept: application/json'
            ]);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            
            $response = curl_exec($ch);
            $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            
            if ($http_code !== 200) {
                logError("MPG API Error: HTTP $http_code - $response");
                return [];
            }
            
            $products = json_decode($response, true);
            
            // Stocker en base de données locale
            foreach ($products as $product) {
                $stmt = $db->prepare("INSERT INTO marchandises 
                    (mpg_product_id, nom, description, poids_kg, dimensions, province_depart_id, 
                    adresse_ramassage, adresse_livraison, date_limite, statut)
                    VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, 'en_attente')");
                
                $stmt->execute([
                    $product['id'],
                    $product['name'],
                    $product['description'],
                    $product['weight_kg'],
                    $product['dimensions'],
                    $product['province_id'],
                    $product['pickup_address'],
                    'Entrepôt MPG, Libreville', // Livraison par défaut à l'entrepôt MPG
                    $product['transport_deadline']
                ]);
            }
            
            return $products;
            
        } catch (PDOException $e) {
            logError("Database error: ".$e->getMessage());
            return [];
        } catch (Exception $e) {
            logError("MPG integration error: ".$e->getMessage());
            return [];
        }
    }
    
    /**
     * Met à jour le statut de transport d'un produit dans MPG
     * @param int $mpg_product_id ID du produit dans MPG
     * @param string $status Nouveau statut
     * @return bool Succès de l'opération
     */
    public function updateTransportStatus($mpg_product_id, $status) {
        try {
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, $this->mpg_api_url."/products/$mpg_product_id/transport-status");
            curl_setopt($ch, CURLOPT_HTTPHEADER, [
                'Authorization: Bearer '.$this->api_key,
                'Content-Type: application/json',
                'Accept: application/json'
            ]);
            curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'PUT');
            curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode(['status' => $status]));
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            
            $response = curl_exec($ch);
            $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            
            return $http_code === 200;
            
        } catch (Exception $e) {
            logError("MPG status update error: ".$e->getMessage());
            return false;
        }
    }
    
    /**
     * Synchronise les données de transport avec MPG
     * @return bool Succès de l'opération
     */
    public function syncTransportData() {
        try {
            $db = getDB();
            
            // Récupérer les livraisons qui doivent être synchronisées
            $stmt = $db->prepare("SELECT m.mpg_product_id, at.statut 
                                FROM marchandises m
                                JOIN affectations_transport at ON at.marchandise_id = m.id
                                WHERE m.mpg_product_id IS NOT NULL AND at.synced_with_mpg = 0");
            $stmt->execute();
            $shipments = $stmt->fetchAll();
            
            foreach ($shipments as $shipment) {
                $success = $this->updateTransportStatus($shipment['mpg_product_id'], $shipment['statut']);
                
                if ($success) {
                    // Marquer comme synchronisé
                    $stmt = $db->prepare("UPDATE affectations_transport SET synced_with_mpg = 1 WHERE marchandise_id = 
                                        (SELECT id FROM marchandises WHERE mpg_product_id = ?)");
                    $stmt->execute([$shipment['mpg_product_id']]);
                }
            }
            
            return true;
            
        } catch (PDOException $e) {
            logError("Sync error: ".$e->getMessage());
            return false;
        }
    }
    
    /**
     * Récupère les détails d'un produit depuis MPG
     * @param int $mpg_product_id ID du produit dans MPG
     * @return array|false Détails du produit ou false en cas d'erreur
     */
    public function getProductDetails($mpg_product_id) {
        try {
            $ch = curl_init();
            curl_setopt($ch, CURLOPT_URL, $this->mpg_api_url."/products/$mpg_product_id");
            curl_setopt($ch, CURLOPT_HTTPHEADER, [
                'Authorization: Bearer '.$this->api_key,
                'Accept: application/json'
            ]);
            curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
            
            $response = curl_exec($ch);
            $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE);
            
            if ($http_code !== 200) {
                logError("MPG API Error: HTTP $http_code - $response");
                return false;
            }
            
            return json_decode($response, true);
            
        } catch (Exception $e) {
            logError("MPG product details error: ".$e->getMessage());
            return false;
        }
    }
}
?>
6. header.php
php
<?php
require_once 'auth.php';
?>
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><?php echo isset($pageTitle) ? $pageTitle . ' - ' : ''; ?>Transporteur Provincial Gabonais</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/assets/css/style.css">
    
    <!-- Favicon -->
    <link rel="icon" href="/assets/images/logo.png" type="image/png">
</head>
<body>
    <header class="navbar navbar-expand-md navbar-dark bg-primary shadow-sm">
        <div class="container">
            <a class="navbar-brand" href="/">
                <img src="/assets/images/logo.png" alt="TPG Logo" width="30" height="30" class="d-inline-block align-top me-2">
                Transporteur Provincial Gabonais
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/"><i class="fas fa-home me-1"></i> Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/transporteur/offres.php"><i class="fas fa-truck me-1"></i> Transporter</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/contact.php"><i class="fas fa-envelope me-1"></i> Contact</a>
                    </li>
                </ul>
                
                <ul class="navbar-nav">
                    <?php if (isLoggedIn()): ?>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                                <i class="fas fa-user-circle me-1"></i> <?php echo $_SESSION['user_name']; ?>
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <?php if (isAdmin()): ?>
                                    <li><a class="dropdown-item" href="/admin/dashboard.php"><i class="fas fa-tachometer-alt me-1"></i> Tableau de bord</a></li>
                                <?php elseif (isTransporter()): ?>
                                    <li><a class="dropdown-item" href="/transporteur/dashboard.php"><i class="fas fa-tachometer-alt me-1"></i> Tableau de bord</a></li>
                                <?php endif; ?>
                                <li><a class="dropdown-item" href="/profil.php"><i class="fas fa-user me-1"></i> Mon profil</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="/logout.php"><i class="fas fa-sign-out-alt me-1"></i> Déconnexion</a></li>
                            </ul>
                        </li>
                    <?php else: ?>
                        <li class="nav-item">
                            <a class="nav-link" href="/connexion.php"><i class="fas fa-sign-in-alt me-1"></i> Connexion</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="/inscription.php"><i class="fas fa-user-plus me-1"></i> Inscription</a>
                        </li>
                    <?php endif; ?>
                </ul>
            </div>
        </div>
    </header>
    
    <main class="container my-4">
        <?php if (isset($_SESSION['success_message'])): ?>
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <?php echo $_SESSION['success_message']; ?>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <?php unset($_SESSION['success_message']); ?>
        <?php endif; ?>
        
        <?php if (isset($_SESSION['error_message'])): ?>
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <?php echo $_SESSION['error_message']; ?>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            <?php unset($_SESSION['error_message']); ?>
        <?php endif; ?>
7. footer.php
php
        </main>
        
        <footer class="bg-dark text-white py-4 mt-5">
            <div class="container">
                <div class="row">
                    <div class="col-md-4 mb-4 mb-md-0">
                        <h5>Transporteur Provincial Gabonais</h5>
                        <p>Plateforme de mise en relation entre transporteurs et marchands pour le transport de marchandises vers Libreville.</p>
                        <div class="social-icons">
                            <a href="#" class="text-white me-2"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="text-white me-2"><i class="fab fa-twitter"></i></a>
                            <a href="#" class="text-white me-2"><i class="fab fa-instagram"></i></a>
                            <a href="#" class="text-white"><i class="fab fa-linkedin-in"></i></a>
                        </div>
                    </div>
                    
                    <div class="col-md-2 mb-4 mb-md-0">
                        <h5>Liens rapides</h5>
                        <ul class="list-unstyled">
                            <li><a href="/" class="text-white">Accueil</a></li>
                            <li><a href="/transporteur/offres.php" class="text-white">Devenir transporteur</a></li>
                            <li><a href="/contact.php" class="text-white">Contact</a></li>
                            <li><a href="/mentions_legales.php" class="text-white">Mentions légales</a></li>
                        </ul>
                    </div>
                    
                    <div class="col-md-3 mb-4 mb-md-0">
                        <h5>Contact</h5>
                        <ul class="list-unstyled">
                            <li><i class="fas fa-map-marker-alt me-2"></i> Libreville, Gabon</li>
                            <li><i class="fas fa-phone me-2"></i> <?php echo SUPPORT_PHONE; ?></li>
                            <li><i class="fas fa-envelope me-2"></i> <?php echo ADMIN_EMAIL; ?></li>
                        </ul>
                    </div>
                    
                    <div class="col-md-3">
                        <h5>Newsletter</h5>
                        <p>Abonnez-vous pour recevoir nos dernières actualités.</p>
                        <form class="mb-3">
                            <div class="input-group">
                                <input type="email" class="form-control" placeholder="Votre email">
                                <button class="btn btn-primary" type="submit"><i class="fas fa-paper-plane"></i></button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <div class="text-center">
                    <p class="mb-0">&copy; <?php echo date('Y'); ?> Transporteur Provincial Gabonais. Tous droits réservés.</p>
                </div>
            </div>
        </footer>
        
        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        
        <!-- Custom JS -->
        <script src="/assets/js/main.js"></script>
        
        <?php if (isset($customScripts)): ?>
            <?php foreach ($customScripts as $script): ?>
                <script src="<?php echo $script; ?>"></script>
            <?php endforeach; ?>
        <?php endif; ?>
    </body>
</html>
8. notifications.php
php
<?php
require_once 'config.php';
require_once 'db_connect.php';

class Notification {
    private $db;
    
    public function __construct() {
        $this->db = getDB();
    }
    
    /**
     * Envoie une notification à un utilisateur
     * @param int $userId ID de l'utilisateur
     * @param string $title Titre de la notification
     * @param string $message Message de la notification
     * @param string $type Type de notification (info, success, warning, danger)
     * @param string $url URL associée (optionnelle)
     * @return bool Succès de l'opération
     */
    public function send($userId, $title, $message, $type = 'info', $url = null) {
        $stmt = $this->db->prepare("INSERT INTO notifications 
                                   (user_id, title, message, type, url, is_read, created_at) 
                                   VALUES (?, ?, ?, ?, ?, 0, NOW())");
        return $stmt->execute([$userId, $title, $message, $type, $url]);
    }
    
    /**
     * Marque une notification comme lue
     * @param int $notificationId ID de la notification
     * @return bool Succès de l'opération
     */
    public function markAsRead($notificationId) {
        $stmt = $this->db->prepare("UPDATE notifications SET is_read = 1 WHERE id = ?");
        return $stmt->execute([$notificationId]);
    }
    
    /**
     * Récupère les notifications d'un utilisateur
     * @param int $userId ID de l'utilisateur
     * @param int $limit Nombre maximum de notifications à retourner
     * @param bool $unreadOnly Ne retourner que les non lues
     * @return array Tableau de notifications
     */
    public function getForUser($userId, $limit = 10, $unreadOnly = false) {
        $query = "SELECT * FROM notifications WHERE user_id = ?";
        
        if ($unreadOnly) {
            $query .= " AND is_read = 0";
        }
        
        $query .= " ORDER BY created_at DESC LIMIT ?";
        
        $stmt = $this->db->prepare($query);
        $stmt->bindValue(1, $userId, PDO::PARAM_INT);
        $stmt->bindValue(2, $limit, PDO::PARAM_INT);
        $stmt->execute();
        
        return $stmt->fetchAll();
    }
    
    /**
     * Envoie une notification par email
     * @param string $email Adresse email
     * @param string $subject Sujet de l'email
     * @param string $body Corps de l'email
     * @return bool Succès de l'opération
     */
    public function sendEmail($email, $subject, $body) {
        // En production, utiliser une bibliothèque comme PHPMailer ou un service externe
        $headers = "From: " . ADMIN_EMAIL . "\r\n";
        $headers .= "Reply-To: " . ADMIN_EMAIL . "\r\n";
        $headers .= "Content-Type: text/html; charset=UTF-8\r\n";
        
        return mail($email, $subject, $body, $headers);
    }
    
    /**
     * Notifie un transporteur lorsqu'une nouvelle livraison est disponible dans sa province
     * @param int $transporterId ID du transporteur
     * @param int $shipmentId ID de la livraison
     * @return bool Succès de l'opération
     */
    public function notifyNewShipment($transporterId, $shipmentId) {
        $db = getDB();
        
        // Récupérer les détails du transporteur
        $stmt = $db->prepare("SELECT u.email FROM users u JOIN transporteurs t ON t.user_id = u.id WHERE t.id = ?");
        $stmt->execute([$transporterId]);
        $transporter = $stmt->fetch();
        
        if (!$transporter) {
            return false;
        }
        
        // Récupérer les détails de la livraison
        $stmt = $db->prepare("SELECT m.nom, p.nom AS province FROM marchandises m 
                             JOIN provinces p ON p.id = m.province_depart_id 
                             WHERE m.id = ?");
        $stmt->execute([$shipmentId]);
        $shipment = $stmt->fetch();
        
        if (!$shipment) {
            return false;
        }
        
        $title = "Nouvelle livraison disponible";
        $message = "Une nouvelle livraison ({$shipment['nom']}) est disponible dans la province {$shipment['province']}.";
        $url = "/transporteur/offres.php?marchandise_id=$shipmentId";
        
        // Envoyer la notification dans l'application
        $this->send($transporterId, $title, $message, 'info', $url);
        
        // Envoyer un email
        $emailSubject = "TPG - $title";
        $emailBody = "<h1>$title</h1>
                     <p>$message</p>
                     <p><a href='" . SITE_URL . "$url'>Voir la livraison</a></p>
                     <p>Cordialement,<br>L'équipe TPG</p>";
        
        return $this->sendEmail($transporter['email'], $emailSubject, $emailBody);
    }
    
    /**
     * Notifie un vendeur lorsque sa livraison a été acceptée
     * @param int $sellerId ID du vendeur
     * @param int $shipmentId ID de la livraison
     * @param int $transporterId ID du transporteur
     * @return bool Succès de l'opération
     */
    public function notifyShipmentAccepted($sellerId, $shipmentId, $transporterId) {
        $db = getDB();
        
        // Récupérer les détails du vendeur
        $stmt = $db->prepare("SELECT email FROM users WHERE id = ?");
        $stmt->execute([$sellerId]);
        $seller = $stmt->fetch();
        
        if (!$seller) {
            return false;
        }
        
        // Récupérer les détails de la livraison
        $stmt = $db->prepare("SELECT nom FROM marchandises WHERE id = ?");
        $stmt->execute([$shipmentId]);
        $shipment = $stmt->fetch();
        
        if (!$shipment) {
            return false;
        }
        
        // Récupérer les détails du transporteur
        $stmt = $db->prepare("SELECT CONCAT(u.prenom, ' ', u.nom) AS name FROM transporteurs t 
                             JOIN users u ON u.id = t.user_id WHERE t.id = ?");
        $stmt->execute([$transporterId]);
        $transporter = $stmt->fetch();
        
        $title = "Votre livraison a été acceptée";
        $message = "Votre livraison {$shipment['nom']} a été acceptée par le transporteur {$transporter['name']}.";
        $url = "/mes-commandes.php?id=$shipmentId";
        
        // Envoyer la notification dans l'application
        $this->send($sellerId, $title, $message, 'success', $url);
        
        // Envoyer un email
        $emailSubject = "TPG - $title";
        $emailBody = "<h1>$title</h1>
                     <p>$message</p>
                     <p><a href='" . SITE_URL . "$url'>Voir la livraison</a></p>
                     <p>Cordialement,<br>L'équipe TPG</p>";
        
        return $this->sendEmail($seller['email'], $emailSubject, $emailBody);
    }
    
    /**
     * Notifie un transporteur lorsque son offre a été acceptée
     * @param int $transporterId ID du transporteur
     * @param int $shipmentId ID de la livraison
     * @return bool Succès de l'opération
     */
    public function notifyBidAccepted($transporterId, $shipmentId) {
        $db = getDB();
        
        // Récupérer les détails du transporteur
        $stmt = $db->prepare("SELECT u.email FROM users u JOIN transporteurs t ON t.user_id = u.id WHERE t.id = ?");
        $stmt->execute([$transporterId]);
        $transporter = $stmt->fetch();
        
        if (!$transporter) {
            return false;
        }
        
        // Récupérer les détails de la livraison
        $stmt = $db->prepare("SELECT nom FROM marchandises WHERE id = ?");
        $stmt->execute([$shipmentId]);
        $shipment = $stmt->fetch();
        
        if (!$shipment) {
            return false;
        }
        
        $title = "Votre offre a été acceptée";
        $message = "Votre offre pour la livraison {$shipment['nom']} a été acceptée.";
        $url = "/transporteur/commandes.php?id=$shipmentId";
        
        // Envoyer la notification dans l'application
        $this->send($transporterId, $title, $message, 'success', $url);
        
        // Envoyer un email
        $emailSubject = "TPG - $title";
        $emailBody = "<h1>$title</h1>
                     <p>$message</p>
                     <p><a href='" . SITE_URL . "$url'>Voir la livraison</a></p>
                     <p>Cordialement,<br>L'équipe TPG</p>";
        
        return $this->sendEmail($transporter['email'], $emailSubject, $emailBody);
    }
    
    /**
     * Notifie un utilisateur lorsqu'un litige est créé
     * @param int $userId ID de l'utilisateur
     * @param int $disputeId ID du litige
     * @return bool Succès de l'opération
     */
    public function notifyDisputeCreated($userId, $disputeId) {
        $db = getDB();
        
        // Récupérer les détails de l'utilisateur
        $stmt = $db->prepare("SELECT email FROM users WHERE id = ?");
        $stmt->execute([$userId]);
        $user = $stmt->fetch();
        
        if (!$user) {
            return false;
        }
        
        // Récupérer les détails du litige
        $stmt = $db->prepare("SELECT reason FROM litiges WHERE id = ?");
        $stmt->execute([$disputeId]);
        $dispute = $stmt->fetch();
        
        $title = "Nouveau litige créé";
        $message = "Un litige a été créé pour la raison: {$dispute['reason']}.";
        $url = "/litiges.php?id=$disputeId";
        
        // Envoyer la notification dans l'application
        $this->send($userId, $title, $message, 'warning', $url);
        
        // Envoyer un email
        $emailSubject = "TPG - $title";
        $emailBody = "<h1>$title</h1>
                     <p>$message</p>
                     <p><a href='" . SITE_URL . "$url'>Voir le litige</a></p>
                     <p>Cordialement,<br>L'équipe TPG</p>";
        
        return $this->sendEmail($user['email'], $emailSubject, $emailBody);
    }
}
?>
9. payment.php
php
<?php
require_once 'config.php';
require_once 'db_connect.php';

class Payment {
    private $db;
    
    public function __construct() {
        $this->db = getDB();
    }
    
    /**
     * Traite un paiement pour une livraison
     * @param int $shipmentId ID de la livraison
     * @param float $amount Montant du paiement
     * @param string $method Méthode de paiement
     * @param string $transactionId ID de transaction
     * @return bool Succès de l'opération
     */
    public function processPayment($shipmentId, $amount, $method = 'mobile_money', $transactionId = null) {
        try {
            $this->db->beginTransaction();
            
            // Vérifier que la livraison existe et est payable
            $stmt = $this->db->prepare("SELECT m.id, ot.prix, ot.transporteur_id 
                                      FROM marchandises m
                                      JOIN offres_transport ot ON ot.marchandise_id = m.id
                                      WHERE m.id = ? AND m.statut = 'livre' AND ot.statut = 'accepte'");
            $stmt->execute([$shipmentId]);
            $shipment = $stmt->fetch();
            
            if (!$shipment) {
                throw new Exception("Livraison non trouvée ou non payable");
            }
            
            // Calculer les montants
            $platformFee = $shipment['prix'] * PLATFORM_FEE;
            $transporterAmount = $shipment['prix'] - $platformFee;
            
            // Enregistrer le paiement
            $stmt = $this->db->prepare("INSERT INTO paiements 
                                      (marchandise_id, montant_total, frais_plateforme, montant_transporteur, 
                                      methode, transaction_id, statut, created_at) 
                                      VALUES (?, ?, ?, ?, ?, ?, 'completed', NOW())");
            $stmt->execute([
                $shipmentId,
                $shipment['prix'],
                $platformFee,
                $transporterAmount,
                $method,
                $transactionId
            ]);
            
            // Créditer le transporteur
            $stmt = $this->db->prepare("UPDATE transporteurs SET solde = solde + ? WHERE id = ?");
            $stmt->execute([$transporterAmount, $shipment['transporteur_id']]);
            
            $this->db->commit();
            return true;
            
        } catch (Exception $e) {
            $this->db->rollBack();
            logError("Payment processing failed: " . $e->getMessage());
            return false;
        }
    }
    
    /**
     * Initie un paiement mobile money
     * @param string $phone Numéro de téléphone
     * @param float $amount Montant
     * @param string $operator Opérateur (moov, airtel, etc.)
     * @return array|false Réponse de l'API ou false en cas d'erreur
     */
    public function initiateMobileMoneyPayment($phone, $amount, $operator = 'moov') {
        // En production, utiliser une API réelle comme Orange Money, MTN Mobile Money, etc.
        // Ceci est une simulation
        
        // Valider le numéro de téléphone
        if (!preg_match('/^(?:\+241|0)[0-9]{8}$/', $phone)) {
            return false;
        }
        
        // Simuler une réponse d'API
        return [
            'success' => true,
            'transaction_id' => 'MM' . uniqid(),
            'amount' => $amount,
            'phone' => $phone,
            'operator' => $operator,
            'timestamp' => date('Y-m-d H:i:s')
        ];
    }
    
    /**
     * Vérifie le statut d'un paiement mobile money
     * @param string $transactionId ID de transaction
     * @return array|false Statut du paiement ou false en cas d'erreur
     */
    public function checkMobileMoneyPayment($transactionId) {
        // Simuler une vérification
        return [
            'success' => true,
            'transaction_id' => $transactionId,
            'status' => 'completed',
            'amount' => 10000, // Montant simulé
            'timestamp' => date('Y-m-d H:i:s')
        ];
    }
    
    /**
     * Effectue un retrait pour un transporteur
     * @param int $transporterId ID du transporteur
     * @param float $amount Montant à retirer
     * @param string $method Méthode de retrait (mobile_money, bank)
     * @param string $account Compte de destination
     * @return bool Succès de l'opération
     */
    public function processWithdrawal($transporterId, $amount, $method = 'mobile_money', $account = '') {
        try {
            $this->db->beginTransaction();
            
            // Vérifier le solde du transporteur
            $stmt = $this->db->prepare("SELECT solde FROM transporteurs WHERE id = ?");
            $stmt->execute([$transporterId]);
            $transporter = $stmt->fetch();
            
            if (!$transporter || $transporter['solde'] < $amount) {
                throw new Exception("Solde insuffisant");
            }
            
            // Enregistrer le retrait
            $stmt = $this->db->prepare("INSERT INTO retraits 
                                      (transporteur_id, montant, methode, compte_destination, statut, created_at) 
                                      VALUES (?, ?, ?, ?, 'pending', NOW())");
            $stmt->execute([
                $transporterId,
                $amount,
                $method,
                $account
            ]);
            
            $withdrawalId = $this->db->lastInsertId();
            
            // Simuler le traitement du retrait (en production, appeler une API de paiement)
            sleep(2); // Simuler un délai de traitement
            
            // Mettre à jour le statut et déduire le solde
            $stmt = $this->db->prepare("UPDATE retraits SET statut = 'completed', processed_at = NOW() WHERE id = ?");
            $stmt->execute([$withdrawalId]);
            
            $stmt = $this->db->prepare("UPDATE transporteurs SET solde = solde - ? WHERE id = ?");
            $stmt->execute([$amount, $transporterId]);
            
            $this->db->commit();
            return true;
            
        } catch (Exception $e) {
            $this->db->rollBack();
            logError("Withdrawal failed: " . $e->getMessage());
            return false;
        }
    }
    
    /**
     * Récupère l'historique des paiements d'un transporteur
     * @param int $transporterId ID du transporteur
     * @param int $limit Nombre maximum de résultats
     * @return array Historique des paiements
     */
    public function getPaymentHistory($transporterId, $limit = 10) {
        $stmt = $this->db->prepare("SELECT p.*, m.nom AS marchandise_nom 
                                   FROM paiements p
                                   JOIN marchandises m ON m.id = p.marchandise_id
                                   JOIN offres_transport ot ON ot.marchandise_id = m.id
                                   WHERE ot.transporteur_id = ?
                                   ORDER BY p.created_at DESC
                                   LIMIT ?");
        $stmt->bindValue(1, $transporterId, PDO::PARAM_INT);
        $stmt->bindValue(2, $limit, PDO::PARAM_INT);
        $stmt->execute();
        
        return $stmt->fetchAll();
    }
    
    /**
     * Récupère l'historique des retraits d'un transporteur
     * @param int $transporterId ID du transporteur
     * @param int $limit Nombre maximum de résultats
     * @return array Historique des retraits
     */
    public function getWithdrawalHistory($transporterId, $limit = 10) {
        $stmt = $this->db->prepare("SELECT * FROM retraits 
                                   WHERE transporteur_id = ?
                                   ORDER BY created_at DESC
                                   LIMIT ?");
        $stmt->bindValue(1, $transporterId, PDO::PARAM_INT);
        $stmt->bindValue(2, $limit, PDO::PARAM_INT);
        $stmt->execute();
        
        return $stmt->fetchAll();
    }
}
?>

asset directory:

1. CSS Files
/assets/css/style.css
css
/* Main Stylesheet */
:root {
    --primary: #2c3e50;
    --secondary: #3498db;
    --success: #27ae60;
    --warning: #f39c12;
    --danger: #e74c3c;
    --light: #f8f9fa;
    --dark: #343a40;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f8f9fa;
    color: #333;
    line-height: 1.6;
}

/* Navbar */
.navbar {
    background-color: white;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 0.8rem 0;
}

.navbar-brand {
    font-weight: 700;
    display: flex;
    align-items: center;
}

.navbar-brand img {
    margin-right: 10px;
}

/* Footer */
.footer {
    background-color: var(--primary);
    color: white;
    padding: 30px 0;
    margin-top: 50px;
}

.footer h5 {
    margin-bottom: 20px;
    font-weight: 600;
}

.footer a {
    color: #ddd;
    text-decoration: none;
}

.footer a:hover {
    color: white;
    text-decoration: underline;
}

.social-icons a {
    color: white;
    font-size: 1.2rem;
    margin-right: 15px;
}

/* Cards */
.card {
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    transition: transform 0.3s, box-shadow 0.3s;
    margin-bottom: 20px;
    border: none;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.1);
}

.card-header {
    font-weight: 600;
    background-color: white;
    border-bottom: 1px solid rgba(0,0,0,0.1);
}

/* Buttons */
.btn {
    border-radius: 6px;
    padding: 0.5rem 1.2rem;
    font-weight: 500;
}

.btn-primary {
    background-color: var(--primary);
    border-color: var(--primary);
}

.btn-primary:hover {
    background-color: #1a252f;
    border-color: #1a252f;
}

.btn-outline-primary {
    color: var(--primary);
    border-color: var(--primary);
}

.btn-outline-primary:hover {
    background-color: var(--primary);
    color: white;
}

/* Tables */
.table {
    border-radius: 8px;
    overflow: hidden;
}

.table-hover tbody tr:hover {
    background-color: rgba(52, 152, 219, 0.05);
}

/* Badges */
.badge {
    font-weight: 500;
    padding: 0.5em 0.8em;
    border-radius: 4px;
}

.bg-primary {
    background-color: var(--primary) !important;
}

/* Forms */
.form-control, .form-select {
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
}

/* Alerts */
.alert {
    border-radius: 8px;
    border: none;
}

/* Utility Classes */
.rounded-lg {
    border-radius: 12px;
}

.shadow-sm {
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* Rating Stars */
.rating {
    color: var(--warning);
    font-size: 1rem;
}

/* Timeline */
.timeline {
    position: relative;
    padding-left: 30px;
}

.timeline-item {
    position: relative;
    padding-bottom: 20px;
}

.timeline-point {
    position: absolute;
    left: -30px;
    top: 0;
    width: 20px;
    height: 20px;
    border-radius: 50%;
    background-color: var(--secondary);
    border: 4px solid white;
    box-shadow: 0 0 0 2px var(--secondary);
}

.timeline-content {
    padding-left: 15px;
}

/* Responsive Adjustments */
@media (max-width: 768px) {
    .navbar-brand {
        font-size: 1rem;
    }
    
    .footer .col-md-4 {
        margin-bottom: 30px;
    }
}
/assets/css/dashboard.css
css
/* Dashboard Specific Styles */
.sidebar {
    position: fixed;
    top: 0;
    bottom: 0;
    left: 0;
    z-index: 100;
    padding: 48px 0 0;
    box-shadow: inset -1px 0 0 rgba(0, 0, 0, 0.1);
}

.sidebar-sticky {
    position: relative;
    top: 0;
    height: calc(100vh - 48px);
    padding-top: 0.5rem;
    overflow-x: hidden;
    overflow-y: auto;
}

.sidebar .nav-link {
    font-weight: 500;
    color: #333;
    padding: 0.75rem 1rem;
    border-radius: 4px;
    margin-bottom: 2px;
}

.sidebar .nav-link.active {
    color: #fff;
    background-color: var(--primary);
}

.sidebar .nav-link:hover:not(.active) {
    background-color: rgba(0, 0, 0, 0.05);
}

.sidebar .nav-link i {
    margin-right: 4px;
    width: 20px;
    text-align: center;
}

.sidebar-heading {
    font-size: 0.75rem;
    text-transform: uppercase;
}

.main-content {
    margin-left: 250px;
    padding: 20px;
}

/* Dashboard Cards */
.dashboard-card {
    border-radius: 10px;
    border: none;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    transition: all 0.3s;
}

.dashboard-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 7px 25px rgba(0, 0, 0, 0.1);
}

.dashboard-card .card-body {
    padding: 1.5rem;
}

.dashboard-card .card-title {
    font-size: 1rem;
    color: #6c757d;
    margin-bottom: 0.5rem;
}

.dashboard-card .card-value {
    font-size: 1.75rem;
    font-weight: 600;
}

/* Activity Feed */
.activity-item {
    padding: 10px 0;
    border-bottom: 1px solid #eee;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-time {
    font-size: 0.75rem;
    color: #6c757d;
}

/* Progress Bars */
.progress-thin {
    height: 6px;
}

/* Document Cards */
.document-card {
    width: 120px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s;
}

.document-card:hover {
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.document-card i {
    color: var(--primary);
}

/* Responsive Adjustments */
@media (max-width: 992px) {
    .sidebar {
        width: 100%;
        height: auto;
        position: relative;
    }
    
    .main-content {
        margin-left: 0;
    }
}

/* Dark Mode Toggle */
.dark-mode {
    background-color: #1a1a2e;
    color: #f8f9fa;
}

.dark-mode .card {
    background-color: #16213e;
    color: #f8f9fa;
}

.dark-mode .sidebar {
    background-color: #0f3460;
    color: white;
}

.dark-mode .sidebar .nav-link {
    color: #e6e6e6;
}

.dark-mode .sidebar .nav-link.active {
    background-color: var(--secondary);
}
2. JavaScript Files
/assets/js/main.js
javascript
// Main JavaScript File
document.addEventListener('DOMContentLoaded', function() {
    // Enable tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // Enable popovers
    const popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'));
    popoverTriggerList.map(function (popoverTriggerEl) {
        return new bootstrap.Popover(popoverTriggerEl);
    });
    
    // Form validation
    const forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function(form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        }, false);
    });
    
    // Dark mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    if (darkModeToggle) {
        darkModeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
        });
        
        // Check for saved dark mode preference
        if (localStorage.getItem('darkMode') === 'true') {
            document.body.classList.add('dark-mode');
            darkModeToggle.checked = true;
        }
    }
    
    // Mobile menu toggle
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', function() {
            document.body.classList.toggle('mobile-menu-open');
        });
    }
    
    // Smooth scrolling for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            document.querySelector(this.getAttribute('href')).scrollIntoView({
                behavior: 'smooth'
            });
        });
    });
    
    // Initialize any maps
    if (typeof initMap === 'function') {
        initMap();
    }
});
/assets/js/dashboard.js
javascript
// Dashboard Specific JavaScript
document.addEventListener('DOMContentLoaded', function() {
    // Sidebar toggle for mobile
    const sidebarToggle = document.querySelector('.sidebar-toggle');
    if (sidebarToggle) {
        sidebarToggle.addEventListener('click', function() {
            document.querySelector('.sidebar').classList.toggle('collapsed');
            document.querySelector('.main-content').classList.toggle('expanded');
        });
    }
    
    // Notification dropdown
    const notificationDropdown = document.getElementById('notificationDropdown');
    if (notificationDropdown) {
        notificationDropdown.addEventListener('show.bs.dropdown', function() {
            // Mark notifications as read when dropdown is opened
            fetch('/api/notifications/mark-as-read', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-Requested-With': 'XMLHttpRequest'
                },
                credentials: 'same-origin'
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      const badge = document.querySelector('.notification-badge');
                      if (badge) {
                          badge.style.display = 'none';
                      }
                  }
              });
        });
    }
    
    // Initialize charts if they exist on the page
    if (typeof Chart !== 'undefined') {
        // Sales chart
        const salesCtx = document.getElementById('salesChart');
        if (salesCtx) {
            new Chart(salesCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Sales',
                        data: [12, 19, 3, 5, 2, 3],
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 2,
                        tension: 0.1,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }
        
        // Traffic sources chart
        const trafficCtx = document.getElementById('trafficChart');
        if (trafficCtx) {
            new Chart(trafficCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Direct', 'Referral', 'Social'],
                    datasets: [{
                        data: [55, 30, 15],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(46, 204, 113, 0.8)'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
    }
    
    // Date range picker
    if (typeof $.fn.daterangepicker !== 'undefined') {
        $('input[name="daterange"]').daterangepicker({
            opens: 'left',
            locale: {
                format: 'YYYY-MM-DD'
            }
        });
    }
    
    // DataTables initialization
    if (typeof $.fn.DataTable !== 'undefined') {
        $('.datatable').DataTable({
            responsive: true,
            language: {
                search: "_INPUT_",
                searchPlaceholder: "Search..."
            }
        });
    }
});
/assets/js/map.js
javascript
// Map Initialization
function initMap() {
    // Check if map container exists
    const mapElement = document.getElementById('map');
    if (!mapElement) return;
    
    // Default coordinates (Libreville, Gabon)
    const defaultLatLng = { lat: 0.4162, lng: 9.4673 };
    
    // Initialize the map
    const map = new google.maps.Map(mapElement, {
        zoom: 12,
        center: defaultLatLng,
        styles: [
            {
                "featureType": "administrative",
                "elementType": "labels.text.fill",
                "stylers": [
                    {
                        "color": "#444444"
                    }
                ]
            },
            {
                "featureType": "landscape",
                "elementType": "all",
                "stylers": [
                    {
                        "color": "#f2f2f2"
                    }
                ]
            },
            {
                "featureType": "poi",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "road",
                "elementType": "all",
                "stylers": [
                    {
                        "saturation": -100
                    },
                    {
                        "lightness": 45
                    }
                ]
            },
            {
                "featureType": "road.highway",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "simplified"
                    }
                ]
            },
            {
                "featureType": "road.arterial",
                "elementType": "labels.icon",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "transit",
                "elementType": "all",
                "stylers": [
                    {
                        "visibility": "off"
                    }
                ]
            },
            {
                "featureType": "water",
                "elementType": "all",
                "stylers": [
                    {
                        "color": "#3498db"
                    },
                    {
                        "visibility": "on"
                    }
                ]
            }
        ]
    });
    
    // Try HTML5 geolocation
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            function(position) {
                const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                
                // Add marker at current location
                new google.maps.Marker({
                    position: pos,
                    map: map,
                    title: 'Your Location',
                    icon: {
                        url: '/assets/images/map-marker-current.png',
                        scaledSize: new google.maps.Size(32, 32)
                    }
                });
                
                map.setCenter(pos);
            },
            function() {
                // Handle location error
                handleLocationError(true, map.getCenter());
            }
        );
    } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, map.getCenter());
    }
    
    // Function to handle location errors
    function handleLocationError(browserHasGeolocation, pos) {
        const infoWindow = new google.maps.InfoWindow({
            content: browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.'
        });
        
        infoWindow.setPosition(pos);
        infoWindow.open(map);
    }
    
    // Add markers from data attribute if they exist
    const markersData = mapElement.dataset.markers;
    if (markersData) {
        try {
            const markers = JSON.parse(markersData);
            markers.forEach(markerData => {
                new google.maps.Marker({
                    position: { lat: markerData.lat, lng: markerData.lng },
                    map: map,
                    title: markerData.title || '',
                    icon: {
                        url: markerData.icon || '/assets/images/map-marker.png',
                        scaledSize: new google.maps.Size(32, 32)
                    }
                });
            });
        } catch (e) {
            console.error('Error parsing markers data:', e);
        }
    }
}

// Load Google Maps API
function loadGoogleMaps() {
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap`;
    script.async = true;
    script.defer = true;
    document.head.appendChild(script);
}

// Load maps when DOM is ready
document.addEventListener('DOMContentLoaded', loadGoogleMaps);
3. Images Directory

transporteur directory:

1. /transporteur/dashboard.php (Updated Complete Version)
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';
requireTransporter();

$db = getDB();
$user_id = $_SESSION['user_id'];

// Get transporter info
$stmt = $db->prepare("SELECT t.*, u.prenom, u.nom, u.email, u.telephone 
    FROM transporteurs t
    JOIN users u ON t.user_id = u.id
    WHERE t.user_id = ?");
$stmt->execute([$user_id]);
$transporter = $stmt->fetch(PDO::FETCH_ASSOC);

// Get active shipments
$stmt = $db->prepare("SELECT a.*, m.nom as marchandise_nom, m.poids_kg, p.nom as province
    FROM affectations_transport a
    JOIN marchandises m ON a.marchandise_id = m.id
    JOIN provinces p ON m.province_depart_id = p.id
    WHERE a.transporteur_id = ? AND a.statut IN ('en_preparation', 'en_route')");
$stmt->execute([$transporter['id']]);
$active_shipments = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Get pending bids
$stmt = $db->prepare("SELECT o.*, m.nom as marchandise_nom, m.poids_kg, p.nom as province
    FROM offres_transport o
    JOIN marchandises m ON o.marchandise_id = m.id
    JOIN provinces p ON m.province_depart_id = p.id
    WHERE o.transporteur_id = ? AND o.statut = 'en_attente'");
$stmt->execute([$transporter['id']]);
$pending_bids = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Get recent deliveries
$stmt = $db->prepare("SELECT a.*, m.nom as marchandise_nom, m.poids_kg, p.nom as province
    FROM affectations_transport a
    JOIN marchandises m ON a.marchandise_id = m.id
    JOIN provinces p ON m.province_depart_id = p.id
    WHERE a.transporteur_id = ? AND a.statut = 'livre'
    ORDER BY a.date_livraison DESC LIMIT 5");
$stmt->execute([$transporter['id']]);
$recent_deliveries = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tableau de bord - TPG</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <?php include '../includes/header.php'; ?>
    
    <div class="container-fluid">
        <div class="row">
            <?php include 'includes/sidebar.php'; ?>
            
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Tableau de bord</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <div class="btn-group me-2">
                            <a href="offres.php" class="btn btn-sm btn-primary">
                                <i class="fas fa-plus"></i> Nouvelle offre
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- Stats Cards -->
                <div class="row mb-4">
                    <div class="col-md-3">
                        <div class="card text-white bg-primary mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Livraisons actives</h5>
                                <p class="card-text display-4"><?php echo count($active_shipments); ?></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-warning mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Offres en attente</h5>
                                <p class="card-text display-4"><?php echo count($pending_bids); ?></p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-info mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Note moyenne</h5>
                                <p class="card-text display-4"><?php echo number_format($transporter['note_moyenne'], 1); ?>/5</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-success mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Livraisons complétées</h5>
                                <p class="card-text display-4"><?php echo $transporter['livraisons_completees'] ?? 0; ?></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Active Shipments -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-truck-moving me-2"></i>Livraisons en cours</h4>
                    </div>
                    <div class="card-body">
                        <?php if (empty($active_shipments)): ?>
                            <div class="alert alert-info">
                                Vous n'avez aucune livraison en cours actuellement.
                            </div>
                        <?php else: ?>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Marchandise</th>
                                            <th>Province</th>
                                            <th>Poids</th>
                                            <th>Statut</th>
                                            <th>Date départ</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php foreach ($active_shipments as $shipment): ?>
                                            <tr>
                                                <td><?php echo htmlspecialchars($shipment['marchandise_nom']); ?></td>
                                                <td><?php echo htmlspecialchars($shipment['province']); ?></td>
                                                <td><?php echo htmlspecialchars($shipment['poids_kg']); ?> kg</td>
                                                <td>
                                                    <span class="badge bg-<?php 
                                                        echo $shipment['statut'] === 'en_route' ? 'warning' : 'info';
                                                    ?>">
                                                        <?php echo $shipment['statut'] === 'en_route' ? 'En transit' : 'En préparation'; ?>
                                                    </span>
                                                </td>
                                                <td><?php echo $shipment['date_depart'] ? date('d/m/Y', strtotime($shipment['date_depart'])) : '--'; ?></td>
                                                <td>
                                                    <a href="commandes.php?id=<?php echo $shipment['id']; ?>" 
                                                       class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-eye"></i> Détails
                                                    </a>
                                                    <?php if ($shipment['statut'] === 'en_preparation'): ?>
                                                        <a href="../api/v1/affectations.php?action=start&id=<?php echo $shipment['id']; ?>" 
                                                           class="btn btn-sm btn-success">
                                                            <i class="fas fa-play"></i> Démarrer
                                                        </a>
                                                    <?php elseif ($shipment['statut'] === 'en_route'): ?>
                                                        <a href="../api/v1/affectations.php?action=complete&id=<?php echo $shipment['id']; ?>" 
                                                           class="btn btn-sm btn-primary">
                                                            <i class="fas fa-check"></i> Compléter
                                                        </a>
                                                    <?php endif; ?>
                                                </td>
                                            </tr>
                                        <?php endforeach; ?>
                                    </tbody>
                                </table>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
                
                <!-- Recent Activity -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-clock me-2"></i>Offres récentes</h4>
                            </div>
                            <div class="card-body">
                                <?php if (empty($pending_bids)): ?>
                                    <div class="alert alert-info">
                                        Vous n'avez aucune offre en attente actuellement.
                                    </div>
                                <?php else: ?>
                                    <div class="list-group">
                                        <?php foreach ($pending_bids as $bid): ?>
                                            <a href="offres.php?id=<?php echo $bid['id']; ?>" 
                                               class="list-group-item list-group-item-action">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h5 class="mb-1"><?php echo htmlspecialchars($bid['marchandise_nom']); ?></h5>
                                                    <small><?php echo number_format($bid['prix'], 0); ?> XAF</small>
                                                </div>
                                                <p class="mb-1">
                                                    <i class="fas fa-map-marker-alt"></i> 
                                                    <?php echo htmlspecialchars($bid['province']); ?> → Libreville
                                                </p>
                                                <small>
                                                    <i class="fas fa-calendar-alt"></i> 
                                                    Livraison avant <?php echo date('d/m/Y', strtotime($bid['date_proposee'])); ?>
                                                </small>
                                            </a>
                                        <?php endforeach; ?>
                                    </div>
                                <?php endif; ?>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-check-circle me-2"></i>Livraisons récentes</h4>
                            </div>
                            <div class="card-body">
                                <?php if (empty($recent_deliveries)): ?>
                                    <div class="alert alert-info">
                                        Aucune livraison récente à afficher.
                                    </div>
                                <?php else: ?>
                                    <div class="list-group">
                                        <?php foreach ($recent_deliveries as $delivery): ?>
                                            <div class="list-group-item">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h5 class="mb-1"><?php echo htmlspecialchars($delivery['marchandise_nom']); ?></h5>
                                                    <small class="text-success">Livré</small>
                                                </div>
                                                <p class="mb-1">
                                                    <i class="fas fa-map-marker-alt"></i> 
                                                    <?php echo htmlspecialchars($delivery['province']); ?> → Libreville
                                                </p>
                                                <small>
                                                    <i class="fas fa-calendar-check"></i> 
                                                    Livré le <?php echo date('d/m/Y', strtotime($delivery['date_livraison'])); ?>
                                                </small>
                                            </div>
                                        <?php endforeach; ?>
                                    </div>
                                <?php endif; ?>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <?php include '../includes/footer.php'; ?>
    <script src="../assets/js/dashboard.js"></script>
</body>
</html>
2. /transporteur/profil.php
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';
requireTransporter();

$db = getDB();
$user_id = $_SESSION['user_id'];

// Get transporter info
$stmt = $db->prepare("SELECT t.*, u.prenom, u.nom, u.email, u.telephone 
    FROM transporteurs t
    JOIN users u ON t.user_id = u.id
    WHERE t.user_id = ?");
$stmt->execute([$user_id]);
$transporter = $stmt->fetch(PDO::FETCH_ASSOC);

// Get provinces served
$stmt = $db->prepare("SELECT p.id, p.nom 
    FROM routes_transporteur r
    JOIN provinces p ON r.province_depart_id = p.id
    WHERE r.transporteur_id = ?");
$stmt->execute([$transporter['id']]);
$provinces = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Handle profile update
if ($_SERVER['REQUEST_METHOD'] === 'POST') {
    try {
        $db->beginTransaction();
        
        // Update user info
        $stmt = $db->prepare("UPDATE users SET 
            prenom = ?, nom = ?, telephone = ?
            WHERE id = ?");
        $stmt->execute([
            $_POST['prenom'],
            $_POST['nom'],
            $_POST['telephone'],
            $user_id
        ]);
        
        // Update transporter info
        $stmt = $db->prepare("UPDATE transporteurs SET
            type_vehicule = ?, capacite_kg = ?,
            plaque_immatriculation = ?, permis_numero = ?
            WHERE user_id = ?");
        $stmt->execute([
            $_POST['type_vehicule'],
            $_POST['capacite_kg'],
            $_POST['plaque_immatriculation'],
            $_POST['permis_numero'],
            $user_id
        ]);
        
        // Update provinces if changed
        if (isset($_POST['provinces'])) {
            // Delete old provinces
            $stmt = $db->prepare("DELETE FROM routes_transporteur WHERE transporteur_id = ?");
            $stmt->execute([$transporter['id']]);
            
            // Add new provinces
            $stmt = $db->prepare("INSERT INTO routes_transporteur 
                (transporteur_id, province_depart_id, province_arrivee_id)
                VALUES (?, ?, 1)"); // 1 = Estuaire (Libreville)
            
            foreach ($_POST['provinces'] as $province_id) {
                $stmt->execute([$transporter['id'], $province_id]);
            }
        }
        
        $db->commit();
        $_SESSION['flash'] = "Profil mis à jour avec succès";
        header("Location: profil.php");
        exit();
    } catch (PDOException $e) {
        $db->rollBack();
        $error = "Erreur de mise à jour: " . $e->getMessage();
    }
}
?>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Profil - TPG</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <?php include '../includes/header.php'; ?>
    
    <div class="container-fluid">
        <div class="row">
            <?php include 'includes/sidebar.php'; ?>
            
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Mon Profil</h1>
                </div>
                
                <?php if (isset($_SESSION['flash'])): ?>
                    <div class="alert alert-success"><?php echo $_SESSION['flash']; unset($_SESSION['flash']); ?></div>
                <?php endif; ?>
                
                <?php if (isset($error)): ?>
                    <div class="alert alert-danger"><?php echo $error; ?></div>
                <?php endif; ?>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4><i class="fas fa-id-card me-2"></i>Informations personnelles</h4>
                            </div>
                            <div class="card-body">
                                <form method="POST">
                                    <div class="mb-3">
                                        <label class="form-label">Prénom</label>
                                        <input type="text" name="prenom" class="form-control" 
                                            value="<?php echo htmlspecialchars($transporter['prenom']); ?>" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Nom</label>
                                        <input type="text" name="nom" class="form-control" 
                                            value="<?php echo htmlspecialchars($transporter['nom']); ?>" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" 
                                            value="<?php echo htmlspecialchars($transporter['email']); ?>" disabled>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Téléphone</label>
                                        <input type="tel" name="telephone" class="form-control" 
                                            value="<?php echo htmlspecialchars($transporter['telephone']); ?>" required>
                                    </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4><i class="fas fa-truck me-2"></i>Informations du transporteur</h4>
                            </div>
                            <div class="card-body">
                                    <div class="mb-3">
                                        <label class="form-label">Type de véhicule</label>
                                        <select name="type_vehicule" class="form-select" required>
                                            <option value="voiture" <?php echo $transporter['type_vehicule'] === 'voiture' ? 'selected' : ''; ?>>Voiture</option>
                                            <option value="camionnette" <?php echo $transporter['type_vehicule'] === 'camionnette' ? 'selected' : ''; ?>>Camionnette</option>
                                            <option value="camion" <?php echo $transporter['type_vehicule'] === 'camion' ? 'selected' : ''; ?>>Camion</option>
                                            <option value="moto" <?php echo $transporter['type_vehicule'] === 'moto' ? 'selected' : ''; ?>>Moto</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Capacité (kg)</label>
                                        <input type="number" name="capacite_kg" class="form-control" 
                                            value="<?php echo htmlspecialchars($transporter['capacite_kg']); ?>" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Plaque d'immatriculation</label>
                                        <input type="text" name="plaque_immatriculation" class="form-control" 
                                            value="<?php echo htmlspecialchars($transporter['plaque_immatriculation']); ?>" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Numéro de permis</label>
                                        <input type="text" name="permis_numero" class="form-control" 
                                            value="<?php echo htmlspecialchars($transporter['permis_numero']); ?>" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Provinces desservies</label>
                                        <select name="provinces[]" class="form-select" multiple required>
                                            <?php foreach (getProvinces() as $id => $name): ?>
                                                <option value="<?php echo $id; ?>" 
                                                    <?php echo in_array($id, array_column($provinces, 'id')) ? 'selected' : ''; ?>>
                                                    <?php echo $name; ?>
                                                </option>
                                            <?php endforeach; ?>
                                        </select>
                                        <small class="text-muted">Maintenez Ctrl pour sélectionner plusieurs provinces</small>
                                    </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mb-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-save me-2"></i> Enregistrer les modifications
                    </button>
                </div>
                </form>
                
                <!-- Account Status -->
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-shield-alt me-2"></i>Statut du compte</h4>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-<?php 
                            echo $transporter['statut'] === 'approuve' ? 'success' : 
                                ($transporter['statut'] === 'en_attente' ? 'warning' : 'danger'); 
                        ?>">
                            <h5 class="alert-heading">
                                <?php 
                                echo $transporter['statut'] === 'approuve' ? 'Compte approuvé' : 
                                    ($transporter['statut'] === 'en_attente' ? 'En attente d\'approbation' : 'Compte rejeté/banni');
                                ?>
                            </h5>
                            <p>
                                <?php if ($transporter['statut'] === 'approuve'): ?>
                                    Votre compte transporteur est actif et vous pouvez faire des offres.
                                <?php elseif ($transporter['statut'] === 'en_attente'): ?>
                                    Votre compte est en cours de vérification par nos administrateurs.
                                <?php else: ?>
                                    Votre compte a été désactivé. Contactez le support pour plus d'informations.
                                <?php endif; ?>
                            </p>
                        </div>
                        
                        <?php if ($transporter['statut'] === 'approuve'): ?>
                            <div class="alert alert-info">
                                <h5 class="alert-heading">Réputation: <?php echo number_format($transporter['note_moyenne'], 1); ?>/5</h5>
                                <p>
                                    Basée sur <?php echo $transporter['livraisons_completees'] ?? 0; ?> livraisons complétées.
                                </p>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <?php include '../includes/footer.php'; ?>
</body>
</html>
3. /transporteur/offres.php
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';
requireTransporter();

$db = getDB();
$user_id = $_SESSION['user_id'];

// Get transporter info to check approval status
$stmt = $db->prepare("SELECT statut FROM transporteurs WHERE user_id = ?");
$stmt->execute([$user_id]);
$transporter_status = $stmt->fetchColumn();

// Handle new offer submission
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['marchandise_id'])) {
    if ($transporter_status !== 'approuve') {
        $_SESSION['flash'] = "Votre compte doit être approuvé avant de pouvoir faire des offres";
        header("Location: offres.php");
        exit();
    }
    
    try {
        $stmt = $db->prepare("INSERT INTO offres_transport 
            (transporteur_id, marchandise_id, prix, date_proposee, commentaire)
            VALUES (?, ?, ?, ?, ?)");
        
        $stmt->execute([
            $_POST['transporteur_id'],
            $_POST['marchandise_id'],
            $_POST['prix'],
            $_POST['date_proposee'],
            $_POST['commentaire'] ?? null
        ]);
        
        $_SESSION['flash'] = "Votre offre a été soumise avec succès";
        header("Location: offres.php");
        exit();
    } catch (PDOException $e) {
        $error = "Erreur lors de la soumission de l'offre: " . $e->getMessage();
    }
}

// Get available shipments
$stmt = $db->prepare("SELECT m.*, p.nom as province 
    FROM marchandises m
    JOIN provinces p ON m.province_depart_id = p.id
    WHERE m.statut = 'en_attente'
    ORDER BY m.date_limite ASC");
$stmt->execute();
$shipments = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Get transporter's active offers
$stmt = $db->prepare("SELECT o.*, m.nom as marchandise_nom, m.poids_kg, p.nom as province
    FROM offres_transport o
    JOIN marchandises m ON o.marchandise_id = m.id
    JOIN provinces p ON m.province_depart_id = p.id
    WHERE o.transporteur_id = ?
    ORDER BY o.created_at DESC");
$stmt->execute([$user_id]);
$offers = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Get transporter ID
$stmt = $db->prepare("SELECT id FROM transporteurs WHERE user_id = ?");
$stmt->execute([$user_id]);
$transporter_id = $stmt->fetchColumn();
?>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Offres - TPG</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <?php include '../includes/header.php'; ?>
    
    <div class="container-fluid">
        <div class="row">
            <?php include 'includes/sidebar.php'; ?>
            
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Mes Offres</h1>
                    <div class="btn-toolbar mb-2 mb-md-0">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newOfferModal">
                            <i class="fas fa-plus me-1"></i> Nouvelle offre
                        </button>
                    </div>
                </div>
                
                <?php if (isset($_SESSION['flash'])): ?>
                    <div class="alert alert-success"><?php echo $_SESSION['flash']; unset($_SESSION['flash']); ?></div>
                <?php endif; ?>
                
                <?php if (isset($error)): ?>
                    <div class="alert alert-danger"><?php echo $error; ?></div>
                <?php endif; ?>
                
                <?php if ($transporter_status !== 'approuve'): ?>
                    <div class="alert alert-warning">
                        <h5 class="alert-heading">Compte en attente d'approbation</h5>
                        <p>
                            Vous ne pouvez pas faire d'offres tant que votre compte n'a pas été approuvé par un administrateur.
                        </p>
                    </div>
                <?php endif; ?>
                
                <!-- Current Offers -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-list me-2"></i>Mes offres actuelles</h4>
                    </div>
                    <div class="card-body">
                        <?php if (empty($offers)): ?>
                            <div class="alert alert-info">
                                Vous n'avez soumis aucune offre pour le moment.
                            </div>
                        <?php else: ?>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Marchandise</th>
                                            <th>Province</th>
                                            <th>Poids</th>
                                            <th>Prix proposé</th>
                                            <th>Date livraison</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php foreach ($offers as $offer): ?>
                                            <tr>
                                                <td><?php echo htmlspecialchars($offer['marchandise_nom']); ?></td>
                                                <td><?php echo htmlspecialchars($offer['province']); ?></td>
                                                <td><?php echo htmlspecialchars($offer['poids_kg']); ?> kg</td>
                                                <td><?php echo number_format($offer['prix'], 0); ?> XAF</td>
                                                <td><?php echo date('d/m/Y', strtotime($offer['date_proposee'])); ?></td>
                                                <td>
                                                    <?php 
                                                    $badge_class = [
                                                        'en_attente' => 'bg-secondary',
                                                        'accepte' => 'bg-success',
                                                        'rejete' => 'bg-danger'
                                                    ][$offer['statut']];
                                                    ?>
                                                    <span class="badge <?php echo $badge_class; ?>">
                                                        <?php echo ucfirst(str_replace('_', ' ', $offer['statut'])); ?>
                                                    </span>
                                                </td>
                                                <td>
                                                    <a href="#" class="btn btn-sm btn-outline-primary">
                                                        <i class="fas fa-eye"></i> Voir
                                                    </a>
                                                    <?php if ($offer['statut'] === 'en_attente'): ?>
                                                        <a href="#" class="btn btn-sm btn-outline-danger">
                                                            <i class="fas fa-times"></i> Annuler
                                                        </a>
                                                    <?php endif; ?>
                                                </td>
                                            </tr>
                                        <?php endforeach; ?>
                                    </tbody>
                                </table>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
                
                <!-- Available Shipments -->
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-boxes me-2"></i>Marchandises disponibles</h4>
                    </div>
                    <div class="card-body">
                        <?php if (empty($shipments)): ?>
                            <div class="alert alert-info">
                                Aucune marchandise disponible pour le moment.
                            </div>
                        <?php else: ?>
                            <div class="row">
                                <?php foreach ($shipments as $shipment): ?>
                                    <div class="col-md-6 mb-4">
                                        <div class="card h-100">
                                            <div class="card-header bg-primary text-white">
                                                <h5 class="mb-0"><?php echo htmlspecialchars($shipment['nom']); ?></h5>
                                            </div>
                                            <div class="card-body">
                                                <p><strong>Province:</strong> <?php echo htmlspecialchars($shipment['province']); ?></p>
                                                <p><strong>Poids:</strong> <?php echo htmlspecialchars($shipment['poids_kg']); ?> kg</p>
                                                <p><strong>Dimensions:</strong> <?php echo htmlspecialchars($shipment['dimensions']); ?></p>
                                                <p><strong>À livrer avant:</strong> <?php echo date('d/m/Y', strtotime($shipment['date_limite'])); ?></p>
                                                
                                                <div class="mt-3">
                                                    <p class="mb-1"><strong>Adresse de ramassage:</strong></p>
                                                    <p class="small"><?php echo htmlspecialchars($shipment['adresse_ramassage']); ?></p>
                                                </div>
                                            </div>
                                            <div class="card-footer bg-light">
                                                <?php if ($transporter_status === 'approuve'): ?>
                                                    <button class="btn btn-success w-100" 
                                                            data-bs-toggle="modal" 
                                                            data-bs-target="#offerModal<?php echo $shipment['id']; ?>">
                                                        <i class="fas fa-hand-holding-usd me-1"></i> Faire une offre
                                                    </button>
                                                <?php else: ?>
                                                    <button class="btn btn-secondary w-100" disabled>
                                                        <i class="fas fa-ban me-1"></i> Compte non approuvé
                                                    </button>
                                                <?php endif; ?>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Offer Modal for each shipment -->
                                    <div class="modal fade" id="offerModal<?php echo $shipment['id']; ?>" tabindex="-1" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h5 class="modal-title">Faire une offre</h5>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <form method="POST">
                                                    <div class="modal-body">
                                                        <input type="hidden" name="transporteur_id" value="<?php echo $transporter_id; ?>">
                                                        <input type="hidden" name="marchandise_id" value="<?php echo $shipment['id']; ?>">
                                                        
                                                        <div class="mb-3">
                                                            <label class="form-label">Prix proposé (XAF)</label>
                                                            <input type="number" name="prix" class="form-control" required>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <label class="form-label">Date de livraison proposée</label>
                                                            <input type="date" name="date_proposee" class="form-control" 
                                                                   min="<?php echo date('Y-m-d'); ?>" required>
                                                        </div>
                                                        
                                                        <div class="mb-3">
                                                            <label class="form-label">Commentaire (optionnel)</label>
                                                            <textarea name="commentaire" class="form-control" rows="3"></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                                                        <button type="submit" class="btn btn-primary">Soumettre l'offre</button>
                                                    </div>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                <?php endforeach; ?>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <?php include '../includes/footer.php'; ?>
    <script src="../assets/js/offres.js"></script>
</body>
</html>
4. /transporteur/commandes.php
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';
requireTransporter();

$db = getDB();
$user_id = $_SESSION['user_id'];

// Get transporter ID
$stmt = $db->prepare("SELECT id FROM transporteurs WHERE user_id = ?");
$stmt->execute([$user_id]);
$transporter_id = $stmt->fetchColumn();

// Get specific shipment if ID is provided
if (isset($_GET['id'])) {
    $stmt = $db->prepare("SELECT a.*, m.*, p.nom as province, 
        u.prenom as client_prenom, u.nom as client_nom, u.telephone as client_telephone
        FROM affectations_transport a
        JOIN marchandises m ON a.marchandise_id = m.id
        JOIN provinces p ON m.province_depart_id = p.id
        JOIN users u ON m.client_id = u.id
        WHERE a.id = ? AND a.transporteur_id = ?");
    $stmt->execute([$_GET['id'], $transporter_id]);
    $shipment = $stmt->fetch(PDO::FETCH_ASSOC);
    
    if (!$shipment) {
        header("HTTP/1.1 404 Not Found");
        exit("Livraison non trouvée");
    }
}

// Get all shipments for this transporter
$stmt = $db->prepare("SELECT a.id, a.statut, a.date_depart, a.date_livraison,
    m.nom as marchandise_nom, m.poids_kg, p.nom as province
    FROM affectations_transport a
    JOIN marchandises m ON a.marchandise_id = m.id
    JOIN provinces p ON m.province_depart_id = p.id
    WHERE a.transporteur_id = ?
    ORDER BY 
        CASE WHEN a.statut IN ('en_preparation', 'en_route') THEN 0 ELSE 1 END,
        a.date_livraison DESC");
$stmt->execute([$transporter_id]);
$shipments = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Handle status updates
if ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_POST['action'])) {
    try {
        switch ($_POST['action']) {
            case 'start':
                $stmt = $db->prepare("UPDATE affectations_transport SET 
                    statut = 'en_route', date_depart = NOW()
                    WHERE id = ? AND transporteur_id = ?");
                $stmt->execute([$_POST['shipment_id'], $transporter_id]);
                break;
                
            case 'complete':
                $stmt = $db->prepare("UPDATE affectations_transport SET 
                    statut = 'livre', date_livraison = NOW()
                    WHERE id = ? AND transporteur_id = ?");
                $stmt->execute([$_POST['shipment_id'], $transporter_id]);
                
                // Update transporter stats
                $stmt = $db->prepare("UPDATE transporteurs SET 
                    livraisons_completees = livraisons_completees + 1
                    WHERE id = ?");
                $stmt->execute([$transporter_id]);
                break;
                
            case 'delay':
                $stmt = $db->prepare("UPDATE affectations_transport SET 
                    statut = 'retarde'
                    WHERE id = ? AND transporteur_id = ?");
                $stmt->execute([$_POST['shipment_id'], $transporter_id]);
                break;
        }
        
        $_SESSION['flash'] = "Statut mis à jour avec succès";
        header("Location: commandes.php?id=".$_POST['shipment_id']);
        exit();
    } catch (PDOException $e) {
        $error = "Erreur de mise à jour: " . $e->getMessage();
    }
}
?>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Commandes - TPG</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <?php include '../includes/header.php'; ?>
    
    <div class="container-fluid">
        <div class="row">
            <?php include 'includes/sidebar.php'; ?>
            
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Mes Commandes</h1>
                </div>
                
                <?php if (isset($_SESSION['flash'])): ?>
                    <div class="alert alert-success"><?php echo $_SESSION['flash']; unset($_SESSION['flash']); ?></div>
                <?php endif; ?>
                
                <?php if (isset($error)): ?>
                    <div class="alert alert-danger"><?php echo $error; ?></div>
                <?php endif; ?>
                
                <div class="row">
                    <div class="col-md-4">
                        <!-- Shipment List -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h4><i class="fas fa-list me-2"></i>Mes Livraisons</h4>
                            </div>
                            <div class="card-body p-0">
                                <?php if (empty($shipments)): ?>
                                    <div class="alert alert-info m-3">
                                        Vous n'avez aucune livraison actuellement.
                                    </div>
                                <?php else: ?>
                                    <div class="list-group list-group-flush">
                                        <?php foreach ($shipments as $s): ?>
                                            <a href="commandes.php?id=<?php echo $s['id']; ?>" 
                                               class="list-group-item list-group-item-action <?php echo isset($shipment) && $shipment['id'] == $s['id'] ? 'active' : ''; ?>">
                                                <div class="d-flex w-100 justify-content-between">
                                                    <h5 class="mb-1"><?php echo htmlspecialchars($s['marchandise_nom']); ?></h5>
                                                    <span class="badge bg-<?php 
                                                        echo $s['statut'] === 'en_route' ? 'warning' : 
                                                            ($s['statut'] === 'livre' ? 'success' : 
                                                            ($s['statut'] === 'retarde' ? 'danger' : 'info'));
                                                    ?>">
                                                        <?php 
                                                        echo $s['statut'] === 'en_route' ? 'En transit' : 
                                                            ($s['statut'] === 'livre' ? 'Livré' : 
                                                            ($s['statut'] === 'retarde' ? 'Retardé' : 'En préparation'));
                                                        ?>
                                                    </span>
                                                </div>
                                                <p class="mb-1">
                                                    <i class="fas fa-map-marker-alt"></i> 
                                                    <?php echo htmlspecialchars($s['province']); ?> → Libreville
                                                </p>
                                                <small>
                                                    <?php if ($s['date_depart']): ?>
                                                        <i class="fas fa-calendar-alt"></i> 
                                                        Départ: <?php echo date('d/m/Y', strtotime($s['date_depart'])); ?>
                                                    <?php endif; ?>
                                                </small>
                                            </a>
                                        <?php endforeach; ?>
                                    </div>
                                <?php endif; ?>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-8">
                        <!-- Shipment Details -->
                        <?php if (isset($shipment)): ?>
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h4>
                                        <i class="fas fa-box me-2"></i>
                                        Détails de la livraison #<?php echo $shipment['id']; ?>
                                    </h4>
                                </div>
                                <div class="card-body">
                                    <div class="row mb-4">
                                        <div class="col-md-6">
                                            <h5>Marchandise</h5>
                                            <p><strong>Nom:</strong> <?php echo htmlspecialchars($shipment['nom']); ?></p>
                                            <p><strong>Description:</strong> <?php echo htmlspecialchars($shipment['description']); ?></p>
                                            <p><strong>Poids:</strong> <?php echo htmlspecialchars($shipment['poids_kg']); ?> kg</p>
                                            <p><strong>Dimensions:</strong> <?php echo htmlspecialchars($shipment['dimensions']); ?></p>
                                        </div>
                                        <div class="col-md-6">
                                            <h5>Client</h5>
                                            <p><strong>Nom:</strong> <?php echo htmlspecialchars($shipment['client_prenom'] . ' ' . htmlspecialchars($shipment['client_nom'])); ?></p>
                                            <p><strong>Téléphone:</strong> <?php echo htmlspecialchars($shipment['client_telephone']); ?></p>
                                            
                                            <h5 class="mt-4">Livraison</h5>
                                            <p><strong>Province:</strong> <?php echo htmlspecialchars($shipment['province']); ?></p>
                                            <p><strong>Ramassage:</strong> <?php echo htmlspecialchars($shipment['adresse_ramassage']); ?></p>
                                            <p><strong>Livraison:</strong> <?php echo htmlspecialchars($shipment['adresse_livraison']); ?></p>
                                            <p><strong>Date limite:</strong> <?php echo date('d/m/Y', strtotime($shipment['date_limite'])); ?></p>
                                        </div>
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Statut</h5>
                                                </div>
                                                <div class="card-body">
                                                    <div class="alert alert-<?php 
                                                        echo $shipment['statut'] === 'en_route' ? 'warning' : 
                                                            ($shipment['statut'] === 'livre' ? 'success' : 
                                                            ($shipment['statut'] === 'retarde' ? 'danger' : 'info'));
                                                    ?>">
                                                        <h5 class="alert-heading">
                                                            <?php 
                                                            echo $shipment['statut'] === 'en_route' ? 'En transit' : 
                                                                ($shipment['statut'] === 'livre' ? 'Livré' : 
                                                                ($shipment['statut'] === 'retarde' ? 'Retardé' : 'En préparation'));
                                                            ?>
                                                        </h5>
                                                        <?php if ($shipment['date_depart']): ?>
                                                            <p>
                                                                <i class="fas fa-calendar-alt"></i> 
                                                                Départ: <?php echo date('d/m/Y H:i', strtotime($shipment['date_depart'])); ?>
                                                            </p>
                                                        <?php endif; ?>
                                                        <?php if ($shipment['date_livraison']): ?>
                                                            <p>
                                                                <i class="fas fa-check-circle"></i> 
                                                                Livré: <?php echo date('d/m/Y H:i', strtotime($shipment['date_livraison'])); ?>
                                                            </p>
                                                        <?php endif; ?>
                                                    </div>
                                                    
                                                    <?php if ($shipment['statut'] === 'en_preparation'): ?>
                                                        <form method="POST">
                                                            <input type="hidden" name="shipment_id" value="<?php echo $shipment['id']; ?>">
                                                            <input type="hidden" name="action" value="start">
                                                            <button type="submit" class="btn btn-success w-100">
                                                                <i class="fas fa-play me-1"></i> Démarrer la livraison
                                                            </button>
                                                        </form>
                                                    <?php elseif ($shipment['statut'] === 'en_route'): ?>
                                                        <form method="POST">
                                                            <input type="hidden" name="shipment_id" value="<?php echo $shipment['id']; ?>">
                                                            <input type="hidden" name="action" value="complete">
                                                            <button type="submit" class="btn btn-primary w-100 mb-2">
                                                                <i class="fas fa-check me-1"></i> Marquer comme livré
                                                            </button>
                                                        </form>
                                                        <form method="POST">
                                                            <input type="hidden" name="shipment_id" value="<?php echo $shipment['id']; ?>">
                                                            <input type="hidden" name="action" value="delay">
                                                            <button type="submit" class="btn btn-warning w-100">
                                                                <i class="fas fa-clock me-1"></i> Signaler un retard
                                                            </button>
                                                        </form>
                                                    <?php endif; ?>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h5>Informations de paiement</h5>
                                                </div>
                                                <div class="card-body">
                                                    <p><strong>Prix convenu:</strong> <?php echo number_format($shipment['prix'], 0); ?> XAF</p>
                                                    <p><strong>Statut paiement:</strong> 
                                                        <?php if ($shipment['statut_paiement'] === 'complete'): ?>
                                                            <span class="badge bg-success">Payé</span>
                                                        <?php else: ?>
                                                            <span class="badge bg-secondary">En attente</span>
                                                        <?php endif; ?>
                                                    </p>
                                                    <?php if ($shipment['statut'] === 'livre' && $shipment['statut_paiement'] !== 'complete'): ?>
                                                        <div class="alert alert-info mt-3">
                                                            <p>Le paiement sera traité dans les 24-48 heures.</p>
                                                        </div>
                                                    <?php endif; ?>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        <?php else: ?>
                            <div class="alert alert-info">
                                <h5 class="alert-heading">Sélectionnez une livraison</h5>
                                <p>Cliquez sur une livraison dans la liste à gauche pour voir les détails.</p>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <?php include '../includes/footer.php'; ?>
    <script src="../assets/js/commandes.js"></script>
</body>
</html>
5. /transporteur/paiements.php
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';
requireTransporter();

$db = getDB();
$user_id = $_SESSION['user_id'];

// Get transporter ID
$stmt = $db->prepare("SELECT id FROM transporteurs WHERE user_id = ?");
$stmt->execute([$user_id]);
$transporter_id = $stmt->fetchColumn();

// Get payment history
$stmt = $db->prepare("SELECT p.*, m.nom as marchandise_nom
    FROM paiements p
    JOIN affectations_transport a ON p.affectation_id = a.id
    JOIN marchandises m ON a.marchandise_id = m.id
    WHERE a.transporteur_id = ?
    ORDER BY p.date_paiement DESC");
$stmt->execute([$transporter_id]);
$payments = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Get pending payments
$stmt = $db->prepare("SELECT a.id, a.prix, m.nom as marchandise_nom, a.date_livraison
    FROM affectations_transport a
    JOIN marchandises m ON a.marchandise_id = m.id
    WHERE a.transporteur_id = ? AND a.statut = 'livre' 
    AND NOT EXISTS (SELECT 1 FROM paiements p WHERE p.affectation_id = a.id)
    ORDER BY a.date_livraison DESC");
$stmt->execute([$transporter_id]);
$pending_payments = $stmt->fetchAll(PDO::FETCH_ASSOC);

// Calculate totals
$total_earned = array_sum(array_column($payments, 'montant'));
$pending_amount = array_sum(array_column($pending_payments, 'prix'));
?>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes Paiements - TPG</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <?php include '../includes/header.php'; ?>
    
    <div class="container-fluid">
        <div class="row">
            <?php include 'includes/sidebar.php'; ?>
            
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Mes Paiements</h1>
                </div>
                
                <!-- Summary Cards -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="card text-white bg-success mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Total gagné</h5>
                                <p class="card-text display-4"><?php echo number_format($total_earned, 0); ?> XAF</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-warning mb-3">
                            <div class="card-body">
                                <h5 class="card-title">En attente</h5>
                                <p class="card-text display-4"><?php echo number_format($pending_amount, 0); ?> XAF</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card text-white bg-primary mb-3">
                            <div class="card-body">
                                <h5 class="card-title">Livraisons payées</h5>
                                <p class="card-text display-4"><?php echo count($payments); ?></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Pending Payments -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h4><i class="fas fa-clock me-2"></i>Paiements en attente</h4>
                    </div>
                    <div class="card-body">
                        <?php if (empty($pending_payments)): ?>
                            <div class="alert alert-info">
                                Aucun paiement en attente.
                            </div>
                        <?php else: ?>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Livraison</th>
                                            <th>Marchandise</th>
                                            <th>Date livraison</th>
                                            <th>Montant</th>
                                            <th>Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php foreach ($pending_payments as $payment): ?>
                                            <tr>
                                                <td>#<?php echo $payment['id']; ?></td>
                                                <td><?php echo htmlspecialchars($payment['marchandise_nom']); ?></td>
                                                <td><?php echo date('d/m/Y', strtotime($payment['date_livraison'])); ?></td>
                                                <td><?php echo number_format($payment['prix'], 0); ?> XAF</td>
                                                <td>
                                                    <span class="badge bg-warning">En attente</span>
                                                    <small class="text-muted">(Traitement sous 48h)</small>
                                                </td>
                                            </tr>
                                        <?php endforeach; ?>
                                    </tbody>
                                </table>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
                
                <!-- Payment History -->
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-history me-2"></i>Historique des paiements</h4>
                    </div>
                    <div class="card-body">
                        <?php if (empty($payments)): ?>
                            <div class="alert alert-info">
                                Aucun historique de paiement.
                            </div>
                        <?php else: ?>
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>Livraison</th>
                                            <th>Marchandise</th>
                                            <th>Montant</th>
                                            <th>Méthode</th>
                                            <th>Statut</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <?php foreach ($payments as $payment): ?>
                                            <tr>
                                                <td><?php echo date('d/m/Y', strtotime($payment['date_paiement'])); ?></td>
                                                <td>#<?php echo $payment['affectation_id']; ?></td>
                                                <td><?php echo htmlspecialchars($payment['marchandise_nom']); ?></td>
                                                <td><?php echo number_format($payment['montant'], 0); ?> XAF</td>
                                                <td><?php echo ucfirst($payment['methode']); ?></td>
                                                <td>
                                                    <span class="badge bg-<?php echo $payment['statut'] === 'complete' ? 'success' : 'warning'; ?>">
                                                        <?php echo $payment['statut'] === 'complete' ? 'Complété' : 'En traitement'; ?>
                                                    </span>
                                                </td>
                                            </tr>
                                        <?php endforeach; ?>
                                    </tbody>
                                </table>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <?php include '../includes/footer.php'; ?>
</body>
</html>
6. /transporteur/reputation.php
php
<?php
require_once '../includes/auth.php';
require_once '../includes/functions.php';
requireTransporter();

$db = getDB();
$user_id = $_SESSION['user_id'];

// Get transporter info
$stmt = $db->prepare("SELECT t.note_moyenne, t.livraisons_completees, 
    u.prenom, u.nom
    FROM transporteurs t
    JOIN users u ON t.user_id = u.id
    WHERE t.user_id = ?");
$stmt->execute([$user_id]);
$transporter = $stmt->fetch(PDO::FETCH_ASSOC);

// Get reviews
$stmt = $db->prepare("SELECT e.*, u.prenom, u.nom, m.nom as marchandise_nom
    FROM evaluations e
    JOIN affectations_transport a ON e.affectation_id = a.id
    JOIN marchandises m ON a.marchandise_id = m.id
    JOIN users u ON e.evaluateur_id = u.id
    WHERE a.transporteur_id = ?
    ORDER BY e.created_at DESC");
$stmt->execute([$user_id]);
$reviews = $stmt->fetchAll(PDO::FETCH_ASSOC);
?>

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ma Réputation - TPG</title>
    <link rel="stylesheet" href="../assets/css/dashboard.css">
</head>
<body>
    <?php include '../includes/header.php'; ?>
    
    <div class="container-fluid">
        <div class="row">
            <?php include 'includes/sidebar.php'; ?>
            
            <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
                <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                    <h1 class="h2">Ma Réputation</h1>
                </div>
                
                <!-- Reputation Summary -->
                <div class="row mb-4">
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-star me-2"></i>Note moyenne</h4>
                            </div>
                            <div class="card-body text-center">
                                <div class="display-2 text-warning mb-3">
                                    <?php echo number_format($transporter['note_moyenne'], 1); ?>/5
                                </div>
                                <div class="star-rating mb-3">
                                    <?php
                                    $full_stars = floor($transporter['note_moyenne']);
                                    $half_star = ($transporter['note_moyenne'] - $full_stars) >= 0.5;
                                    
                                    for ($i = 1; $i <= 5; $i++) {
                                        if ($i <= $full_stars) {
                                            echo '<i class="fas fa-star"></i>';
                                        } elseif ($half_star && $i == $full_stars + 1) {
                                            echo '<i class="fas fa-star-half-alt"></i>';
                                        } else {
                                            echo '<i class="far fa-star"></i>';
                                        }
                                    }
                                    ?>
                                </div>
                                <p class="text-muted">
                                    Basée sur <?php echo $transporter['livraisons_completees']; ?> livraisons
                                </p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card">
                            <div class="card-header">
                                <h4><i class="fas fa-chart-bar me-2"></i>Répartition des notes</h4>
                            </div>
                            <div class="card-body">
                                <canvas id="ratingsChart" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Recent Reviews -->
                <div class="card">
                    <div class="card-header">
                        <h4><i class="fas fa-comments me-2"></i>Avis récents</h4>
                    </div>
                    <div class="card-body">
                        <?php if (empty($reviews)): ?>
                            <div class="alert alert-info">
                                Vous n'avez encore reçu aucun avis.
                            </div>
                        <?php else: ?>
                            <div class="list-group">
                                <?php foreach ($reviews as $review): ?>
                                    <div class="list-group-item">
                                        <div class="d-flex w-100 justify-content-between">
                                            <h5 class="mb-1"><?php echo htmlspecialchars($review['prenom'] . ' ' . htmlspecialchars($review['nom'])); ?></h5>
                                            <div class="star-rating text-warning">
                                                <?php
                                                for ($i = 1; $i <= 5; $i++) {
                                                    echo $i <= $review['note'] ? '<i class="fas fa-star"></i>' : '<i class="far fa-star"></i>';
                                                }
                                                ?>
                                            </div>
                                        </div>
                                        <p class="mb-1">
                                            <strong>Livraison:</strong> <?php echo htmlspecialchars($review['marchandise_nom']); ?>
                                        </p>
                                        <p class="mb-1"><?php echo htmlspecialchars($review['commentaire']); ?></p>
                                        <small class="text-muted">
                                            <?php echo date('d/m/Y H:i', strtotime($review['created_at'])); ?>
                                        </small>
                                    </div>
                                <?php endforeach; ?>
                            </div>
                        <?php endif; ?>
                    </div>
                </div>
            </main>
        </div>
    </div>
    
    <?php include '../includes/footer.php'; ?>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Ratings distribution chart
        const ctx = document.getElementById('ratingsChart').getContext('2d');
        const ratingsChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['1 étoile', '2 étoiles', '3 étoiles', '4 étoiles', '5 étoiles'],
                datasets: [{
                    label: 'Nombre d\'avis',
                    data: [
                        <?php 
                        $counts = [0, 0, 0, 0, 0];
                        foreach ($reviews as $review) {
                            $counts[$review['note'] - 1]++;
                        }
                        echo implode(', ', $counts);
                        ?>
                    ],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                        'rgba(255, 205, 86, 0.7)',
                        'rgba(75, 192, 192, 0.7)',
                        'rgba(54, 162, 235, 0.7)'
                    ],
                    borderColor: [
                        'rgb(255, 99, 132)',
                        'rgb(255, 159, 64)',
                        'rgb(255, 205, 86)',
                        'rgb(75, 192, 192)',
                        'rgb(54, 162, 235)'
                    ],
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 1
                        }
                    }
                },
                plugins: {
                    legend: {
                        display: false
                    }
                }
            }
        });
    </script>
</body>
</html>
7. /transporteur/includes/sidebar.php (Missing File)
php
<div class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
    <div class="position-sticky pt-3">
        <ul class="nav flex-column">
            <li class="nav-item">
                <a class="nav-link <?php echo basename($_SERVER['PHP_SELF']) === 'dashboard.php' ? 'active' : ''; ?>" 
                   href="dashboard.php">
                    <i class="fas fa-tachometer-alt me-2"></i>
                    Tableau de bord
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?php echo basename($_SERVER['PHP_SELF']) === 'profil.php' ? 'active' : ''; ?>" 
                   href="profil.php">
                    <i class="fas fa-user me-2"></i>
                    Mon Profil
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?php echo basename($_SERVER['PHP_SELF']) === 'offres.php' ? 'active' : ''; ?>" 
                   href="offres.php">
                    <i class="fas fa-hand-holding-usd me-2"></i>
                    Mes Offres
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?php echo basename($_SERVER['PHP_SELF']) === 'commandes.php' ? 'active' : ''; ?>" 
                   href="commandes.php">
                    <i class="fas fa-truck-loading me-2"></i>
                    Mes Commandes
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?php echo basename($_SERVER['PHP_SELF']) === 'paiements.php' ? 'active' : ''; ?>" 
                   href="paiements.php">
                    <i class="fas fa-money-bill-wave me-2"></i>
                    Paiements
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link <?php echo basename($_SERVER['PHP_SELF']) === 'reputation.php' ? 'active' : ''; ?>" 
                   href="reputation.php">
                    <i class="fas fa-star me-2"></i>
                    Réputation
                </a>
            </li>
        </ul>
        
        <hr>
        
        <ul class="nav flex-column mb-2">
            <li class="nav-item">
                <a class="nav-link" href="../contact.php">
                    <i class="fas fa-question-circle me-2"></i>
                    Support
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-danger" href="../includes/auth.php?action=logout">
                    <i class="fas fa-sign-out-alt me-2"></i>
                    Déconnexion
                </a>
            </li>
        </ul>
    </div>
</div>



Database Schema
sql
CREATE DATABASE transporteur_provincial;
USE transporteur_provincial;

-- Gabon's provinces
CREATE TABLE provinces (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nom VARCHAR(50) NOT NULL UNIQUE
);

-- Transporters (individuals with vehicles)
CREATE TABLE transporteurs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT NOT NULL,
    type_vehicule ENUM('voiture', 'camionnette', 'camion', 'moto') NOT NULL,
    capacite_kg DECIMAL(10,2) NOT NULL,
    plaque_immatriculation VARCHAR(20),
    permis_numero VARCHAR(30),
    statut ENUM('en_attente', 'approuve', 'rejete', 'banni') DEFAULT 'en_attente',
    note_moyenne DECIMAL(3,2) DEFAULT 0.00,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Transport routes (provinces they travel between)
CREATE TABLE routes_transporteur (
    id INT AUTO_INCREMENT PRIMARY KEY,
    transporteur_id INT NOT NULL,
    province_depart_id INT NOT NULL,
    province_arrivee_id INT NOT NULL,
    frequence ENUM('occasionnel', 'regulier', 'hebdomadaire') DEFAULT 'occasionnel',
    jour_semaine VARCHAR(15),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (transporteur_id) REFERENCES transporteurs(id),
    FOREIGN KEY (province_depart_id) REFERENCES provinces(id),
    FOREIGN KEY (province_arrivee_id) REFERENCES provinces(id)
);

-- Goods needing transport (from MPG)
CREATE TABLE marchandises (
    id INT AUTO_INCREMENT PRIMARY KEY,
    mpg_product_id INT NOT NULL, -- ID from MPG system
    nom VARCHAR(255) NOT NULL,
    description TEXT,
    poids_kg DECIMAL(10,2) NOT NULL,
    dimensions VARCHAR(50),
    province_depart_id INT NOT NULL,
    adresse_ramassage VARCHAR(255) NOT NULL,
    adresse_livraison VARCHAR(255) NOT NULL,
    date_limite DATE NOT NULL,
    statut ENUM('en_attente', 'affecte', 'en_transit', 'livre', 'annule') DEFAULT 'en_attente',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (province_depart_id) REFERENCES provinces(id)
);

-- Bids from transporters
CREATE TABLE offres_transport (
    id INT AUTO_INCREMENT PRIMARY KEY,
    transporteur_id INT NOT NULL,
    marchandise_id INT NOT NULL,
    prix DECIMAL(10,2) NOT NULL,
    date_proposee DATE NOT NULL,
    commentaire TEXT,
    statut ENUM('en_attente', 'accepte', 'rejete') DEFAULT 'en_attente',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (transporteur_id) REFERENCES transporteurs(id),
    FOREIGN KEY (marchandise_id) REFERENCES marchandises(id)
);

-- Transport assignments
CREATE TABLE affectations_transport (
    id INT AUTO_INCREMENT PRIMARY KEY,
    marchandise_id INT NOT NULL,
    transporteur_id INT NOT NULL,
    offre_id INT NOT NULL,
    date_depart DATE,
    date_livraison DATE,
    statut ENUM('en_preparation', 'en_route', 'livre', 'retarde', 'annule') DEFAULT 'en_preparation',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (marchandise_id) REFERENCES marchandises(id),
    FOREIGN KEY (transporteur_id) REFERENCES transporteurs(id),
    FOREIGN KEY (offre_id) REFERENCES offres_transport(id)
);

-- Initial data - Gabon's provinces
INSERT INTO provinces (nom) VALUES 
('Estuaire'),
('Haut-Ogooué'),
('Moyen-Ogooué'),
('Ngounié'),
('Nyanga'),
('Ogooué-Ivindo'),
('Ogooué-Lolo'),
('Ogooué-Maritime'),
('Woleu-Ntem');
